<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾é‡æ´¥è²¼èˆ‡éœ€æ±‚å½ˆæ€§äº’å‹•æ•™å­¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
        <div class="flex justify-end mb-4">
            <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-1 flex">
                <button id="langZh" class="lang-btn px-3 py-1 rounded text-sm font-medium bg-primary text-white">
                    ä¸­æ–‡
                </button>
                <button id="langEn" class="lang-btn px-3 py-1 rounded text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    English
                </button>
            </div>
        </div>
        
        <div class="text-center mb-6">
            <h1 id="mainTitle" class="text-3xl font-bold mb-2">å¾é‡æ´¥è²¼ VS éœ€æ±‚å½ˆæ€§ã€ä¾›çµ¦å½ˆæ€§äº’å‹•æ•™å­¸</h1>
        </div>

        <div class="grid lg:grid-cols-5 gap-6">
            <!-- æƒ…å¢ƒé¸æ“‡ - ç§»åˆ°å·¦æ–¹ -->
            <div class="lg:col-span-1">
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <div class="space-y-4">
                        <div>
                            <label id="task1Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™1</span>ï¼š<span class="text-red-600 dark:text-red-400">å¾é‡æ´¥è²¼</span></label>
                            <div class="grid grid-cols-1 gap-2">
                                <button id="unitSubsidy" class="tax-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="unitSubsidyText">å¾é‡æ´¥è²¼</span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task2Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™2</span>ï¼š<span class="text-red-600 dark:text-red-400">éœ€æ±‚å½ˆæ€§é¡å‹</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="highElastic" class="elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="highElasticText">é«˜å½ˆæ€§</span>
                                </button>
                                <button id="lowElastic" class="elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="lowElasticText">ä½å½ˆæ€§</span>
                                </button>
                            </div>

                        </div>

                        <div>
                            <label id="task3Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™3</span>ï¼š<span class="text-red-600 dark:text-red-400">ä¾›çµ¦å½ˆæ€§é¡å‹</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="highSupplyElastic" class="supply-elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="highSupplyElasticText">é«˜å½ˆæ€§</span>
                                </button>
                                <button id="lowSupplyElastic" class="supply-elasticity-btn px-3 py-2 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary transition-colors text-base">
                                    <span id="lowSupplyElasticText">ä½å½ˆæ€§</span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task4Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™4</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span></label>
                            <div class="grid grid-cols-1 gap-2">
                                <button id="benefit" class="benefit-btn px-3 py-2 rounded border-2 border-green-500 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 hover:border-green-600 transition-colors text-sm cursor-move select-none" draggable="true">
                                    <span id="benefitText">æ¶ˆè²»è€…ç²å¾—æ´¥è²¼</span>
                                </button>
                                <button id="loss" class="benefit-btn px-3 py-2 rounded border-2 border-yellow-600 bg-yellow-100 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-100 hover:border-yellow-700 transition-colors text-sm cursor-move select-none" draggable="true">
                                    <span id="lossText">ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼</span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task5Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™5</span>ï¼š<span class="text-red-600 dark:text-red-400">æ‹–æ‹½åˆ°åœ–è¡¨</span></label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="lessThan" class="comparison-btn px-3 py-2 rounded border-2 border-blue-500 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 hover:border-blue-600 transition-colors text-base cursor-move select-none text-xl font-bold" draggable="true">
                                    &lt;
                                </button>
                                <button id="greaterThan" class="comparison-btn px-3 py-2 rounded border-2 border-purple-500 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 hover:border-purple-600 transition-colors text-base cursor-move select-none text-xl font-bold" draggable="true">
                                    &gt;
                                </button>
                            </div>
                        </div>

                        <div>
                            <label id="task6Label" class="block text-sm font-medium mb-2"><span class="text-red-600 dark:text-red-400">ä»»å‹™6</span>ï¼š<span class="text-red-600 dark:text-red-400">æäº¤</span></label>
                            <button id="submitBtn" class="w-full bg-red-600 text-white px-3 py-2 rounded border-2 border-red-600 hover:bg-red-700 transition-colors text-base disabled:opacity-50 disabled:cursor-not-allowed">
                                <span id="submitBtnText">æäº¤ç­”æ¡ˆ</span>
                            </button>
                            <div id="submitFeedback" class="hidden mt-2 p-3 rounded-lg text-sm font-medium"></div>
                        </div>

                        <div>
                            <label id="resetLabel" class="block text-sm font-medium mb-2"><span class="text-blue-600 dark:text-blue-400">é‡æ–°é–‹å§‹</span></label>
                            <button id="resetBtn" class="w-full bg-gray-600 text-white px-3 py-2 rounded border-2 border-gray-600 hover:bg-gray-700 transition-colors text-base">
                                <span id="resetBtnText">é‡æ–°æ•´ç†</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ–è¡¨å€åŸŸ -->
            <div class="lg:col-span-4">
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">
                    <canvas id="economicChart" width="600" height="400" class="w-full h-auto border border-gray-300 dark:border-gray-600 rounded"></canvas>
                </div>
                
                <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
                <div id="resultsPanel" class="hidden bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mt-4">
                    <h3 class="text-lg font-semibold mb-4">åˆ†æçµæœ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded">
                            <div class="font-medium">åƒ¹æ ¼è®ŠåŒ–</div>
                            <div id="priceChange" class="text-lg font-bold text-blue-600 dark:text-blue-400">--</div>
                        </div>
                        <div class="bg-green-100 dark:bg-green-900 p-3 rounded">
                            <div class="font-medium">éœ€æ±‚é‡è®ŠåŒ–</div>
                            <div id="quantityChange" class="text-lg font-bold text-green-600 dark:text-green-400">--</div>
                        </div>
                        <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded">
                            <div class="font-medium">æ”¶å…¥è®ŠåŒ–</div>
                            <div id="revenueChange" class="text-lg font-bold text-purple-600 dark:text-purple-400">--</div>
                        </div>
                    </div>
                    <div id="explanation" class="mt-4 p-3 bg-yellow-100 dark:bg-yellow-900 rounded text-sm"></div>
                </div>
            </div>

        </div>

        <!-- ç·´ç¿’é¡Œå€åŸŸ -->
        <div class="mt-8">
            <div id="quizSection" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                <h2 id="quizTitle" class="text-2xl font-bold mb-6 text-center">å¾é‡æ´¥è²¼èˆ‡å½ˆæ€§ç·´ç¿’é¡Œ</h2>
                
                <!-- ç·´ç¿’é¡Œè§£é–æç¤º -->
                <div id="quizLockMessage" class="mb-6 p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg border-l-4 border-yellow-500">
                    <h3 id="quizLockTitle" class="text-lg font-semibold mb-2 text-yellow-800 dark:text-yellow-200">ğŸ”’ ç·´ç¿’é¡Œå°šæœªè§£é–</h3>
                    <div class="text-yellow-700 dark:text-yellow-300">
                        <p id="quizLockDesc" class="mb-2">è«‹å…ˆå®Œæˆä»¥ä¸‹ä»»å‹™æ‰èƒ½é–‹å§‹ç·´ç¿’é¡Œï¼š</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="bg-yellow-50 dark:bg-yellow-800 p-3 rounded">
                                <div id="taskGroup1" class="font-medium">ä»»å‹™çµ„åˆ1ï¼šé«˜å½ˆæ€§æƒ…å¢ƒ</div>
                                <div id="highElasticProgress" class="mt-1 text-xs">
                                    âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                                </div>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-800 p-3 rounded">
                                <div id="taskGroup2" class="font-medium">ä»»å‹™çµ„åˆ2ï¼šä½å½ˆæ€§æƒ…å¢ƒ</div>
                                <div id="lowElasticProgress" class="mt-1 text-xs">
                                    âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                                </div>
                            </div>
                        </div>
                        <p id="quizHint" class="mt-3 text-xs">ğŸ’¡ æç¤ºï¼šæ¯ç¨®å½ˆæ€§é¡å‹éƒ½éœ€è¦å®Œæˆä»»å‹™1-6çš„å®Œæ•´æµç¨‹ï¼ˆé¸æ“‡å¾é‡æ´¥è²¼â†’é¸æ“‡å½ˆæ€§é¡å‹â†’æ‹–æ‹½æ´¥è²¼æ¨™ç±¤â†’æ‹–æ‹½æ¯”è¼ƒç¬¦è™Ÿâ†’æäº¤ç­”æ¡ˆï¼‰</p>
                    </div>
                </div>
                
                <!-- é¡Œç›®1 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-blue-500">
                    <h3 id="q1Title" class="text-lg font-semibold mb-3">é¡Œç›®1ï¼šæ´¥è²¼åˆ†æ“”ç†è§£</h3>
                    <p id="q1Question" class="mb-4">ç•¶æ¶ˆè²»è€…ç²å¾—æ´¥è²¼è¼ƒç”Ÿç”¢è€…å°‘æ™‚ï¼Œæ„å‘³è‘—ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="demand_less_elastic" class="text-primary focus:ring-primary">
                            <span>éœ€æ±‚å½ˆæ€§å°æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| < |Es|ï¼‰</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="demand_more_elastic" class="text-primary focus:ring-primary">
                            <span>éœ€æ±‚å½ˆæ€§å¤§æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| > |Es|ï¼‰</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q1" value="elasticity_equal" class="text-primary focus:ring-primary">
                            <span>éœ€æ±‚å½ˆæ€§ç­‰æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| = |Es|ï¼‰</span>
                        </label>
                    </div>
                    <div id="feedback1" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®2 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-green-500">
                    <h3 id="q2Title" class="text-lg font-semibold mb-3">é¡Œç›®2ï¼šéœ€æ±‚å½ˆæ€§èˆ‡æ´¥è²¼åˆ†æ“”</h3>
                    <p id="q2Question" class="mb-4">ç•¶å•†å“éœ€æ±‚å½ˆæ€§<strong>ä½æ–¼</strong>ä¾›çµ¦å½ˆæ€§æ™‚ï¼Œå¾é‡æ´¥è²¼ä¸»è¦ç”±èª°ç²å¾—ï¼Ÿ</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="consumer_gains_more" class="text-primary focus:ring-primary">
                            <span>æ¶ˆè²»è€…ç²å¾—è¼ƒå¤šæ´¥è²¼</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="producer_gains_more" class="text-primary focus:ring-primary">
                            <span>ç”Ÿç”¢è€…ç²å¾—è¼ƒå¤šæ´¥è²¼</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q2" value="equal_gain" class="text-primary focus:ring-primary">
                            <span>æ¶ˆè²»è€…èˆ‡ç”Ÿç”¢è€…å¹³å‡åˆ†äº«</span>
                        </label>
                    </div>
                    <div id="feedback2" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®3 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-purple-500">
                    <h3 id="q3Title" class="text-lg font-semibold mb-3">é¡Œç›®3ï¼šæ´¥è²¼åˆ†æ“”æ±ºå®šå› ç´ </h3>
                    <p id="q3Question" class="mb-4">å¾é‡æ´¥è²¼çš„å—ç›Šåˆ†æ“”ä¸»è¦å–æ±ºæ–¼ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="demand_elasticity_only" class="text-primary focus:ring-primary">
                            <span>å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="supply_elasticity_only" class="text-primary focus:ring-primary">
                            <span>å–æ±ºæ–¼ä¾›çµ¦å½ˆæ€§</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q3" value="elasticity_ratio" class="text-primary focus:ring-primary">
                            <span>å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§èˆ‡ä¾›çµ¦å½ˆæ€§çš„ç›¸å°å¤§å°</span>
                        </label>
                    </div>
                    <div id="feedback3" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®4 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-orange-500">
                    <h3 id="q4Title" class="text-lg font-semibold mb-3">é¡Œç›®4ï¼šç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥</h3>
                    <p id="q4Question" class="mb-4">ç•¶æ”¿åºœå¯¦æ–½å¾é‡æ´¥è²¼å¾Œï¼Œç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q4" value="uncertain" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®š</span>
                        </label>
                    </div>
                    <div id="feedback4" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®5 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-pink-500">
                    <h3 id="q5Title" class="text-lg font-semibold mb-3">é¡Œç›®5ï¼šç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥</h3>
                    <p id="q5Question" class="mb-4">ç•¶æ”¿åºœå¯¦æ–½å¾é‡æ´¥è²¼å¾Œï¼Œç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q5" value="uncertain" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®š</span>
                        </label>
                    </div>
                    <div id="feedback5" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®6 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-indigo-500">
                    <h3 id="q6Title" class="text-lg font-semibold mb-3">é¡Œç›®6ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥</h3>
                    <p id="q6Question" class="mb-4">ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q6" value="increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q6" value="decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q6" value="uncertain" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®š</span>
                        </label>
                    </div>
                    <div id="feedback6" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®7 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-yellow-500">
                    <h3 id="q7Title" class="text-lg font-semibold mb-3">é¡Œç›®7ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥</h3>
                    <p id="q7Question" class="mb-4">ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q7" value="increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q7" value="decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q7" value="uncertain" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®š</span>
                        </label>
                    </div>
                    <div id="feedback7" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®8 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-teal-500">
                    <h3 id="q8Title" class="text-lg font-semibold mb-3">é¡Œç›®8ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹æ¶ˆè²»è€…ç¸½æ”¯å‡º</h3>
                    <p id="q8Question" class="mb-4">ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œæ¶ˆè²»è€…ç¸½æ”¯å‡ºæœƒï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q8" value="increase" class="text-primary focus:ring-primary">
                            <span>å¢åŠ </span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q8" value="decrease" class="text-primary focus:ring-primary">
                            <span>æ¸›å°‘</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q8" value="uncertain" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®š</span>
                        </label>
                    </div>
                    <div id="feedback8" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- é¡Œç›®9 -->
                <div class="mb-6 p-4 bg-white dark:bg-gray-700 rounded-lg border-l-4 border-red-500">
                    <h3 id="q9Title" class="text-lg font-semibold mb-3">é¡Œç›®9ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹æ´¥è²¼åˆ†æ“”</h3>
                    <p id="q9Question" class="mb-4">ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œæ¶ˆè²»è€…å’Œç”Ÿç”¢è€…æ´¥è²¼ç²å¾—æ¯”ä¾‹ï¼š</p>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q9" value="consumer_gains_more" class="text-primary focus:ring-primary">
                            <span>æ¶ˆè²»è€…ç²å¾—è¼ƒå¤šæ´¥è²¼</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q9" value="producer_gains_more" class="text-primary focus:ring-primary">
                            <span>ç”Ÿç”¢è€…ç²å¾—è¼ƒå¤šæ´¥è²¼</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="q9" value="uncertain_ratio" class="text-primary focus:ring-primary">
                            <span>ä¸èƒ½ç¢ºå®šé›™æ–¹ç²å¾—æ¯”ä¾‹</span>
                        </label>
                    </div>
                    <div id="feedback9" class="hidden mt-3 p-3 rounded-lg text-sm"></div>
                </div>

                <!-- ç¸½åˆ†é¡¯ç¤º -->
                <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg text-center">
                    <div id="totalScore" class="text-lg font-semibold text-blue-800 dark:text-blue-200">
                        å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†
                    </div>
                    <button id="resetQuiz" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                        <span id="resetQuizBtn">é‡æ–°ä½œç­”</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼æ”¯æ´
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        class ElasticitySimulator {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // åœ–è¡¨åƒæ•¸
                this.margin = { top: 20, right: 40, bottom: 60, left: 60 };
                this.chartWidth = this.width - this.margin.left - this.margin.right;
                this.chartHeight = this.height - this.margin.top - this.margin.bottom;
                
                // ç‹€æ…‹
                this.selectedUnitTax = false; // æ˜¯å¦é¸æ“‡å¾é‡æ´¥è²¼
                this.selectedElasticity = null; // 'high' or 'low'
                this.selectedSupplyElasticity = null; // 'high' or 'low'
                this.selectedBenefit = null; // 'benefit' or 'loss'
                this.prediction = null; // 'up', 'same', 'down'
                this.isDragging = false;
                this.dragPoint = null;
                this.hasModifiedDemandLine = false; // è·Ÿè¸ªæ˜¯å¦å·²ä¿®æ”¹éœ€æ±‚ç·š
                
                // å®Œæˆè¿½è¸ªç‹€æ…‹
                this.completedTasks = {
                    high: false,  // æ˜¯å¦å®Œæˆéé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                    low: false    // æ˜¯å¦å®Œæˆéä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹
                };
                
                // æç¤ºæ¡†ç‹€æ…‹
                this.showHint = false;
                this.hintOpacity = 1;
                this.hintInterval = null;
                
                // ç¶“æ¿Ÿåƒæ•¸
                this.basePrice = 50;
                this.baseQuantity = 40;
                this.priceChangePercent = 0.2; // 20%
                this.demandSlope = -1.0; // åˆå§‹45åº¦éœ€æ±‚ç·šæ–œç‡
                this.demandIntercept = 90; // éœ€æ±‚ç·šæˆªè·
                
                // ä¾›çµ¦ç·šåƒæ•¸
                this.supplySlope = 1.0; // æ­£æ–œç‡ï¼Œå‘ä¸Šå‚¾æ–œ
                this.supplyIntercept = 10; // ä¾›çµ¦ç·šæˆªè·ï¼ˆS1ï¼‰
                this.originalSupplyIntercept = 10; // ä¿å­˜åŸå§‹ä¾›çµ¦ç·šæˆªè·
                this.unitTaxAmount = 30; // å¾é‡æ´¥è²¼é¡åº¦ - å¢åŠ åˆ°30ä½¿å€åŸŸæ›´æ˜é¡¯
                
                // å‡è¡¡é»åƒæ•¸
                this.equilibriumP1 = null; // åŸå§‹å‡è¡¡åƒ¹æ ¼
                this.equilibriumQ1 = null; // åŸå§‹å‡è¡¡æ•¸é‡
                this.equilibriumP2 = null; // æ–°å‡è¡¡åƒ¹æ ¼ï¼ˆæ´¥è²¼å¾Œï¼‰
                this.equilibriumQ2 = null; // æ–°å‡è¡¡æ•¸é‡ï¼ˆæ´¥è²¼å¾Œï¼‰
                
                this.scenarios = {
                    high: { elasticity: -2.0, demandSlope: -0.8 }, // é«˜å½ˆæ€§
                    low: { elasticity: -0.4, demandSlope: -3.0 }   // ä½å½ˆæ€§
                };
                
                // æ‹–æ‹½ç‹€æ…‹
                this.isDraggedToCanvas = false;
                this.draggedType = null;
                this.draggedPositions = {}; // å­˜å„²å¤šå€‹æ‹–æ‹½ä½ç½® {benefit: {x, y}, loss: {x, y}}
                
                // ä»»å‹™5ç‹€æ…‹
                this.selectedComparison = null; // '<' or '>'
                this.isComparisonDraggedToCanvas = false;
                
                this.init();
            }
            
            init() {
                this.drawChart();
                this.setupEventListeners();
                this.setupCanvasEvents();
                this.setupDragAndDrop();
                this.updateTaskAvailability(); // åˆå§‹åŒ–ä»»åŠ¡å¯ç”¨æ€§
            }
            
            setupEventListeners() {
                // å¾é‡æ´¥è²¼æŒ‰éˆ•
                document.getElementById('unitSubsidy').addEventListener('click', () => {
                    this.selectUnitSubsidy();
                });
                
                // å½ˆæ€§é¸æ“‡æŒ‰éˆ•
                document.getElementById('highElastic').addEventListener('click', () => {
                    this.selectElasticity('high');
                });
                
                document.getElementById('lowElastic').addEventListener('click', () => {
                    this.selectElasticity('low');
                });
                
                // ä¾›çµ¦å½ˆæ€§é¸æ“‡æŒ‰éˆ•
                document.getElementById('highSupplyElastic').addEventListener('click', () => {
                    this.selectSupplyElasticity('high');
                });
                
                document.getElementById('lowSupplyElastic').addEventListener('click', () => {
                    this.selectSupplyElasticity('low');
                });
                
                // æäº¤æŒ‰éˆ•
                document.getElementById('submitBtn').addEventListener('click', () => {
                    this.submitAnswer();
                });
                
                // é‡æ–°æ•´ç†æŒ‰éˆ•
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetAll();
                });
            }
            
            setupDragAndDrop() {
                // æ‹–æ‹½äº‹ä»¶ç›£è½å™¨
                document.getElementById('benefit').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'benefit');
                });
                
                document.getElementById('loss').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'loss');
                });
                
                // ä»»å‹™5æ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½
                document.getElementById('lessThan').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'lessThan');
                });
                
                document.getElementById('greaterThan').addEventListener('dragstart', (e) => {
                    this.handleDragStart(e, 'greaterThan');
                });
                
                // Canvasä½œç‚ºæ‹–æ‹½ç›®æ¨™
                this.canvas.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.canvas.style.cursor = 'copy';
                });
                
                this.canvas.addEventListener('dragleave', (e) => {
                    this.canvas.style.cursor = 'default';
                });
                
                this.canvas.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.canvas.style.cursor = 'default';
                    this.handleDrop(e);
                });
            }
            
            handleDragStart(e, type) {
                this.draggedType = type;
                // è¨­ç½®æ‹–æ‹½æ•¸æ“š
                e.dataTransfer.setData('text/plain', type);
                e.dataTransfer.effectAllowed = 'copy';
                
                // æ·»åŠ æ‹–æ‹½æ™‚çš„è¦–è¦ºæ•ˆæœ
                setTimeout(() => {
                    if (e.target && e.target.style) {
                        e.target.style.opacity = '0.5';
                    }
                }, 0);
            }
            
            handleDrop(e) {
                const draggedType = e.dataTransfer.getData('text/plain');
                
                // æ¢å¾©æ‹–æ‹½å…ƒç´ çš„é€æ˜åº¦
                const draggedElement = document.getElementById(draggedType);
                if (draggedElement && draggedElement.style) {
                    draggedElement.style.opacity = '1';
                }
                
                // ç²å–æ‹–æ‹½ä½ç½®
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                const canvasX = (e.clientX - rect.left) * scaleX;
                const canvasY = (e.clientY - rect.top) * scaleY;
                
                // ä»»å‹™5ï¼šæ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½è™•ç†
                if (draggedType === 'lessThan' || draggedType === 'greaterThan') {
                    // æª¢æŸ¥æ˜¯å¦æ”¾åœ¨æ¯”è¼ƒæ¡†å€åŸŸ
                    const comparisonZone = this.getComparisonDropZone(canvasX, canvasY);
                    
                    if (comparisonZone) {
                        // æˆåŠŸæ”¾ç½®åœ¨æ¯”è¼ƒæ¡†ä¸­
                        this.selectedComparison = draggedType === 'lessThan' ? '<' : '>';
                        this.isComparisonDraggedToCanvas = true;
                        
                        // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                        this.updateTaskAvailability();
                        
                        // é‡æ–°ç¹ªè£½åœ–è¡¨ä»¥é¡¯ç¤ºæ¯”è¼ƒç¬¦è™Ÿ
                        this.drawChart();
                        
                        // æä¾›æ”¾ç½®ç¢ºèªåé¥‹
                        this.showComparisonDropConfirmation(this.selectedComparison);
                    } else {
                        // æ”¾éŒ¯åœ°æ–¹
                        this.showComparisonDropError();
                    }
                    return;
                }
                
                // ä»»å‹™4ï¼šæ´¥è²¼æ‹–æ‹½è™•ç†
                if (draggedType === 'benefit' || draggedType === 'loss') {
                    // æª¢æŸ¥æ˜¯å¦æ”¾åœ¨æ´¥è²¼å€åŸŸ
                    const dropZone = this.getDropZone(canvasX, canvasY);
                    
                    if (dropZone) {
                        // æˆåŠŸæ”¾ç½®åœ¨æœ‰æ•ˆå€åŸŸ
                        this.selectedBenefit = draggedType;
                        this.isDraggedToCanvas = true;
                        
                        // è¨˜éŒ„å­¸ç”Ÿå¯¦éš›é¸æ“‡çš„å€åŸŸ
                        this.studentDropZone = dropZone;
                        
                        // æ›´æ–°è¦–è¦ºåé¥‹
                        this.updateDraggedVisualization(canvasX, canvasY, draggedType, dropZone);
                        
                        // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                        this.updateTaskAvailability();
                        
                        // æä¾›æ”¾ç½®ç¢ºèªåé¥‹
                        this.showDropConfirmation(draggedType, dropZone);
                    } else {
                        // å®Œå…¨æ”¾éŒ¯åœ°æ–¹
                        this.showDropError();
                    }
                }
            }
            
            getDropZone(canvasX, canvasY) {
                // æª¢æŸ¥åŸºæœ¬æ¢ä»¶
                if (!this.selectedUnitTax || !this.selectedSupplyElasticity) {
                    return null;
                }
                
                // ç¢ºä¿å‡è¡¡é»å·²è¨ˆç®—
                if (!this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) {
                    this.calculateOriginalEquilibrium();
                    this.calculateNewEquilibrium();
                }
                
                // ä½¿ç”¨èˆ‡é¡¯ç¤ºä½ç½®ç›¸åŒçš„è¨ˆç®—é‚è¼¯
                const consumerSubsidyArea = this.calculateConsumerSubsidyArea();
                const producerSubsidyArea = this.calculateProducerSubsidyArea();
                
                // æª¢æŸ¥æ˜¯å¦åœ¨æ¶ˆè²»è€…æ´¥è²¼é¢ç©ï¼š(P1-P2)*Q2
                if (canvasX >= consumerSubsidyArea.x && canvasX <= consumerSubsidyArea.x + consumerSubsidyArea.width && 
                    canvasY >= consumerSubsidyArea.y && canvasY <= consumerSubsidyArea.y + consumerSubsidyArea.height) {
                    return 'CONSUMER_SUBSIDY_AREA';
                }
                
                // æª¢æŸ¥æ˜¯å¦åœ¨ç”Ÿç”¢è€…æ´¥è²¼é¢ç©ï¼š(P3-P1)*Q2
                if (canvasX >= producerSubsidyArea.x && canvasX <= producerSubsidyArea.x + producerSubsidyArea.width && 
                    canvasY >= producerSubsidyArea.y && canvasY <= producerSubsidyArea.y + producerSubsidyArea.height) {
                    return 'PRODUCER_SUBSIDY_AREA';
                }
                
                return null;
            }
            
            updateDraggedVisualization(x, y, type, dropZone) {
                // å„²å­˜æ‹–æ‹½ä½ç½®ã€é¡å‹å’Œå­¸ç”Ÿå¯¦éš›é¸æ“‡çš„å€åŸŸ
                this.draggedPositions[type] = { x, y, zone: dropZone };
                
                // é‡æ–°ç¹ªè£½åœ–è¡¨ï¼ˆæœƒè‡ªå‹•åŒ…å«æ‰€æœ‰æ‹–æ‹½æ¨™ç±¤ï¼‰
                this.drawChart();
            }
            
            drawDraggedLabels() {
                // ç¹ªè£½æ‰€æœ‰å·²æ‹–æ‹½çš„æ¨™ç±¤
                for (const [type, position] of Object.entries(this.draggedPositions)) {
                    if (position) {
                        this.drawSingleDraggedLabel(position.x, position.y, type);
                    }
                }
            }
            
            drawSingleDraggedLabel(x, y, type) {
                this.ctx.save();
                
                // è¨ˆç®—å°æ‡‰å€åŸŸçš„ç²¾ç¢ºä½ç½®å’Œå°ºå¯¸
                const areaInfo = this.calculateAreaPosition(type);
                if (!areaInfo) {
                    this.ctx.restore();
                    return;
                }
                
                // ç¹ªè£½ç­”æ¡ˆæ¨™ç±¤
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                const text = type === 'benefit' ? 
                    (currentLang === 'en' ? 'Consumer Gets Subsidy' : 'æ¶ˆè²»è€…ç²å¾—æ´¥è²¼') : 
                    (currentLang === 'en' ? 'Producer Gets Subsidy' : 'ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼');
                const bgColor = type === 'benefit' ? '#10B981' : '#D4AF37';
                const textColor = '#FFFFFF';
                
                // ä½¿ç”¨å¯¦éš›è¨ˆç®—çš„å€åŸŸä½ç½®å’Œå°ºå¯¸
                let rectX = areaInfo.x;
                let rectY = areaInfo.y;
                let rectWidth = areaInfo.width;
                let rectHeight = areaInfo.height;
                
                // è¨­å®šæœ€å°å°ºå¯¸
                const minWidth = 80;
                const minHeight = 25;
                
                rectWidth = Math.max(minWidth, rectWidth);
                rectHeight = Math.max(minHeight, rectHeight);
                
                // ç¹ªè£½èƒŒæ™¯çŸ©å½¢
                this.ctx.fillStyle = bgColor;
                this.ctx.globalAlpha = 0.8;
                
                this.ctx.beginPath();
                this.roundRect(rectX, rectY, rectWidth, rectHeight, 4);
                this.ctx.fill();
                
                // ç¹ªè£½é‚Šæ¡†
                this.ctx.globalAlpha = 1;
                this.ctx.strokeStyle = bgColor;
                this.ctx.lineWidth = 1;
                this.ctx.stroke();
                
                // ç¹ªè£½æ–‡å­—
                this.ctx.fillStyle = textColor;
                this.ctx.globalAlpha = 1;
                this.ctx.font = 'bold 10px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                const textX = rectX + rectWidth / 2;
                const textY = rectY + rectHeight / 2;
                
                // æ ¹æ“šå¯¬åº¦é¸æ“‡é©ç•¶çš„æ–‡å­—
                let displayText = text;
                if (rectWidth < 120) {
                    displayText = type === 'benefit' ? 'æ¶ˆè²»è€…æ´¥è²¼' : 'ç”Ÿç”¢è€…æ´¥è²¼';
                }
                if (rectWidth < 80) {
                    displayText = type === 'benefit' ? 'æ¶ˆè²»è€…' : 'ç”Ÿç”¢è€…';
                }
                
                this.ctx.fillText(displayText, textX, textY);
                
                this.ctx.restore();
            }
            
            calculateAreaPosition(type) {
                if (!this.selectedUnitTax || !this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) {
                    return null;
                }
                
                // æ ¹æ“šå­¸ç”Ÿå¯¦éš›æ‹–æ‹½åˆ°çš„å€åŸŸä¾†ç¢ºå®šä½ç½®
                let targetZone = null;
                if (this.draggedPositions[type] && this.draggedPositions[type].zone) {
                    targetZone = this.draggedPositions[type].zone;
                } else {
                    return null;
                }
                
                // æ ¹æ“šå¯¦éš›æ‹–æ‹½çš„å€åŸŸè¨ˆç®—ä½ç½®
                if (targetZone === 'CONSUMER_SUBSIDY_AREA') {
                    const consumerSubsidyArea = this.calculateConsumerSubsidyArea();
                    return {
                        x: consumerSubsidyArea.x,
                        y: consumerSubsidyArea.y,
                        width: Math.max(consumerSubsidyArea.width, 40),
                        height: Math.max(consumerSubsidyArea.height, 20)
                    };
                } else if (targetZone === 'PRODUCER_SUBSIDY_AREA') {
                    const producerSubsidyArea = this.calculateProducerSubsidyArea();
                    return {
                        x: producerSubsidyArea.x,
                        y: producerSubsidyArea.y,
                        width: Math.max(producerSubsidyArea.width, 40),
                        height: Math.max(producerSubsidyArea.height, 20)
                    };
                } else {
                    return null;
                }
            }
            
            calculateConsumerSubsidyArea() {
                // å¾é‡æ´¥è²¼æƒ…æ³ä¸‹ï¼šæ¶ˆè²»è€…ç²å¾—æ´¥è²¼é¢ç© = (P1-P2)*Q2 çŸ©å½¢
                const validP1 = Math.max(0, Math.min(100, this.equilibriumP1));
                const validP2 = Math.max(0, Math.min(100, this.equilibriumP2));
                
                // åœ¨å¾é‡æ´¥è²¼æƒ…æ³ä¸‹ï¼ŒP1 > P2ï¼ˆåƒ¹æ ¼ä¸‹é™ï¼‰
                if (validP1 <= validP2) {
                    return {
                        x: this.margin.left,
                        y: this.toCanvasY(validP1),
                        width: this.toCanvasX(this.equilibriumQ2) - this.margin.left,
                        height: 0
                    };
                }
                
                // Xåº§æ¨™ï¼šå¾Yè»¸é–‹å§‹åˆ°Q2å‚ç›´ç·š
                let consumerSubsidyX = this.margin.left;
                let consumerSubsidyWidth = Math.max(0, this.toCanvasX(this.equilibriumQ2) - this.margin.left);
                
                // Yåº§æ¨™ï¼šå¾P2é–‹å§‹ï¼Œåˆ°P1çµæŸ
                let consumerSubsidyY = this.toCanvasY(validP1);  // ä¸Šé‚Šç•Œï¼ˆP1ï¼‰
                let consumerSubsidyHeight = this.toCanvasY(validP2) - this.toCanvasY(validP1); // P1åˆ°P2çš„é«˜åº¦
                
                return {
                    x: consumerSubsidyX,
                    y: consumerSubsidyY,
                    width: consumerSubsidyWidth,
                    height: Math.max(0, consumerSubsidyHeight)
                };
            }
            
            calculateProducerSubsidyArea() {
                // å¾é‡æ´¥è²¼æƒ…æ³ä¸‹ï¼šç”Ÿç”¢è€…ç²å¾—æ´¥è²¼é¢ç© = (P3-P1)*Q2 çŸ©å½¢
                const equilibriumP3 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ2;
                
                const validP3 = Math.max(0, Math.min(100, equilibriumP3));
                const validP1 = Math.max(0, Math.min(100, this.equilibriumP1));
                
                if (validP3 <= validP1) {
                    return {
                        x: this.margin.left,
                        y: this.toCanvasY(validP1) - 10,
                        width: Math.max(0, this.toCanvasX(this.equilibriumQ2) - this.margin.left),
                        height: 10
                    };
                }
                
                const producerSubsidyX = this.margin.left;
                const producerSubsidyWidth = Math.max(0, this.toCanvasX(this.equilibriumQ2) - this.margin.left);
                
                const producerSubsidyY = this.toCanvasY(validP3);
                const producerSubsidyHeight = this.toCanvasY(validP1) - this.toCanvasY(validP3);
                
                return {
                    x: producerSubsidyX,
                    y: producerSubsidyY,
                    width: producerSubsidyWidth,
                    height: Math.max(0, producerSubsidyHeight)
                };
            }
            
            showDropConfirmation(type, zone) {
                this.ctx.save();
                
                const typeText = type === 'benefit' ? 'æ¶ˆè²»è€…ç²å¾—æ´¥è²¼' : 'ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼';
                
                let zoneText = '';
                switch(zone) {
                    case 'CONSUMER_SUBSIDY_AREA':
                        zoneText = 'æ¶ˆè²»è€…æ´¥è²¼å€åŸŸ (P1-P2)Ã—Q2';
                        break;
                    case 'PRODUCER_SUBSIDY_AREA':
                        zoneText = 'ç”Ÿç”¢è€…æ´¥è²¼å€åŸŸ (P3-P1)Ã—Q2';
                        break;
                    default:
                        zoneText = 'æ´¥è²¼åˆ†äº«é¢ç©';
                }
                
                const message = `å·²æ”¾ç½®ï¼š${typeText} â†’ ${zoneText}`;
                const bgColor = '#3B82F6';
                
                const boxX = this.width / 2 - 150;
                const boxY = 10;
                const boxWidth = 300;
                const boxHeight = 30;
                
                this.ctx.fillStyle = bgColor;
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            showDropError() {
                this.ctx.save();
                
                const message = 'è«‹æ‹–æ‹½åˆ°æ´¥è²¼åˆ†äº«é¢ç©ï¼š(P1-P2)Ã—Q2 æˆ– (P3-P1)Ã—Q2';
                const boxX = this.width / 2 - 140;
                const boxY = 10;
                const boxWidth = 280;
                const boxHeight = 30;
                
                this.ctx.fillStyle = '#EF4444';
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 10px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            selectUnitSubsidy() {
                this.selectedUnitTax = true;
                this.updateButtonStates('.tax-btn', 0);
                
                // è¨ˆç®—åŸå§‹å‡è¡¡é»ï¼ˆS1èˆ‡Dçš„äº¤é»ï¼‰
                this.calculateOriginalEquilibrium();
                
                // å¾é‡æ´¥è²¼ä½¿ä¾›çµ¦ç·šå‘ä¸‹ç§»å‹•ï¼ˆS1 â†’ S2ï¼‰
                this.supplyIntercept = this.originalSupplyIntercept - this.unitTaxAmount;
                
                // è¨ˆç®—æ–°å‡è¡¡é»ï¼ˆS2èˆ‡Dçš„äº¤é»ï¼‰
                this.calculateNewEquilibrium();
                
                this.updateTaskAvailability();
                this.drawChart();
            }
            
            calculateOriginalEquilibrium() {
                const denominator = this.supplySlope - this.demandSlope;
                if (Math.abs(denominator) < 0.001) {
                    this.equilibriumQ1 = this.baseQuantity;
                    this.equilibriumP1 = this.basePrice;
                } else {
                    this.equilibriumQ1 = (this.demandIntercept - this.originalSupplyIntercept) / denominator;
                    this.equilibriumP1 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ1;
                    
                    this.equilibriumQ1 = Math.max(0, Math.min(80, this.equilibriumQ1));
                    this.equilibriumP1 = Math.max(0, Math.min(100, this.equilibriumP1));
                }
            }
            
            calculateNewEquilibrium() {
                const denominator = this.supplySlope - this.demandSlope;
                if (Math.abs(denominator) < 0.001) {
                    this.equilibriumQ2 = this.baseQuantity * 1.2;
                    this.equilibriumP2 = this.basePrice * 0.8;
                } else {
                    this.equilibriumQ2 = (this.demandIntercept - this.supplyIntercept) / denominator;
                    this.equilibriumP2 = this.supplyIntercept + this.supplySlope * this.equilibriumQ2;
                    
                    this.equilibriumQ2 = Math.max(0, Math.min(80, this.equilibriumQ2));
                    this.equilibriumP2 = Math.max(0, Math.min(100, this.equilibriumP2));
                }
            }
            
            selectElasticity(type) {
                if (!this.selectedUnitTax) {
                    return;
                }
                
                this.selectedElasticity = type;
                this.updateButtonStates('.elasticity-btn', type === 'high' ? 0 : 1);
                
                // æ ¹æ“šå½ˆæ€§é¡å‹è‡ªå‹•èª¿æ•´éœ€æ±‚ç·šæ–œç‡
                if (type === 'high') {
                    // é«˜å½ˆæ€§ï¼šè¼ƒå¹³ç·©çš„éœ€æ±‚ç·šï¼ˆæ–œç‡å°æ–¼-1ï¼‰
                    this.demandSlope = -0.8;
                } else {
                    // ä½å½ˆæ€§ï¼šè¼ƒé™¡å³­çš„éœ€æ±‚ç·šï¼ˆæ–œç‡å¤§æ–¼-1ï¼‰
                    this.demandSlope = -3.0;
                }
                
                // é‡æ–°è¨ˆç®—æˆªè·ä»¥ä¿æŒéœ€æ±‚ç·šé€šéåŸºæº–é»
                this.demandIntercept = this.basePrice - this.demandSlope * this.baseQuantity;
                
                // é‡æ–°è¨ˆç®—å‡è¡¡é»ï¼ˆå¦‚æœå·²é¸æ“‡å¾é‡æ´¥è²¼ï¼‰
                if (this.selectedUnitTax) {
                    this.calculateOriginalEquilibrium();
                    this.calculateNewEquilibrium();
                }
                
                // é‡ç½®æ‹–æ‹½ç›¸é—œç‹€æ…‹
                this.draggedPositions = {};
                this.isDraggedToCanvas = false;
                this.selectedBenefit = null;
                
                // æ›´æ–°ä»»å‹™å¯ç”¨æ€§
                this.updateTaskAvailability();
                this.drawChart();
            }
            
            selectSupplyElasticity(type) {
                if (!this.selectedUnitTax || !this.selectedElasticity) {
                    return;
                }
                
                this.selectedSupplyElasticity = type;
                this.updateButtonStates('.supply-elasticity-btn', type === 'high' ? 0 : 1);
                
                // æ ¹æ“šä¾›çµ¦å½ˆæ€§é¡å‹èª¿æ•´ä¾›çµ¦ç·šæ–œç‡
                if (type === 'high') {
                    this.supplySlope = 0.6; // é«˜å½ˆæ€§ï¼šè¼ƒå¹³ç·©çš„æ–œç‡
                } else {
                    this.supplySlope = 2.0; // ä½å½ˆæ€§ï¼šæ›´é™¡å³­çš„æ–œç‡
                }
                
                // é‡æ–°è¨ˆç®—å‡è¡¡é»
                if (this.selectedUnitTax) {
                    this.calculateOriginalEquilibrium();
                    this.calculateNewEquilibrium();
                }
                
                // æ¸…é™¤å·²æœ‰çš„æ‹–æ‹½æ¨™ç±¤
                this.draggedPositions = {};
                this.isDraggedToCanvas = false;
                this.selectedBenefit = null;
                
                this.updateTaskAvailability();
                this.drawChart();
            }
            
            updateButtonStates(selector, activeIndex) {
                const buttons = document.querySelectorAll(selector);
                buttons.forEach((btn, index) => {
                    btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                    btn.classList.add('border-gray-300', 'dark:border-gray-600');
                    
                    if (index === activeIndex) {
                        btn.classList.remove('border-gray-300', 'dark:border-gray-600');
                        btn.classList.add('border-primary', 'bg-primary', 'text-white');
                    }
                });
            }
            
            updateTaskAvailability() {
                // ä»»å‹™2ï¼ˆéœ€æ±‚å½ˆæ€§é¡å‹ï¼‰æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const elasticityButtons = document.querySelectorAll('.elasticity-btn');
                elasticityButtons.forEach(btn => {
                    if (this.selectedUnitTax) {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                        btn.classList.add('hover:border-primary');
                    } else {
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                        btn.classList.remove('hover:border-primary');
                    }
                });
                
                // ä»»å‹™3ï¼ˆä¾›çµ¦å½ˆæ€§é¡å‹ï¼‰æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const supplyElasticityButtons = document.querySelectorAll('.supply-elasticity-btn');
                supplyElasticityButtons.forEach(btn => {
                    if (this.selectedUnitTax && this.selectedElasticity) {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                        btn.classList.add('hover:border-primary');
                    } else {
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                        btn.classList.remove('hover:border-primary');
                    }
                });
                
                // ä»»å‹™4æ‹–æ‹½æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const benefitButtons = document.querySelectorAll('.benefit-btn');
                benefitButtons.forEach(btn => {
                    if (this.selectedUnitTax && this.selectedElasticity && this.selectedSupplyElasticity) {
                        btn.style.pointerEvents = 'auto';
                        btn.classList.remove('opacity-50');
                        btn.setAttribute('draggable', 'true');
                    } else {
                        btn.style.pointerEvents = 'none';
                        btn.classList.add('opacity-50');
                        btn.setAttribute('draggable', 'false');
                    }
                });
                
                // ä»»å‹™5æ¯”è¼ƒç¬¦è™Ÿæ‹–æ‹½æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
                const comparisonButtons = document.querySelectorAll('.comparison-btn');
                comparisonButtons.forEach(btn => {
                    if (this.selectedUnitTax && this.selectedElasticity && this.selectedSupplyElasticity && this.isDraggedToCanvas) {
                        btn.style.pointerEvents = 'auto';
                        btn.classList.remove('opacity-50');
                        btn.setAttribute('draggable', 'true');
                    } else {
                        btn.style.pointerEvents = 'none';
                        btn.classList.add('opacity-50');
                        btn.setAttribute('draggable', 'false');
                    }
                });
            }
            
            drawComparisonBox() {
                const isDark = document.documentElement.classList.contains('dark');
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                
                // æ ¹æ®è¯­è¨€è°ƒæ•´æ¡†çš„å®½åº¦å’Œæ–‡å­—
                const boxWidth = currentLang === 'en' ? 200 : 130;
                const boxHeight = 32;
                const gainText = currentLang === 'en' ? 'Consumer' : 'æ¶ˆè²»è€…æ´¥è²¼';
                const lossText = currentLang === 'en' ? 'Producer' : 'ç”Ÿç”¢è€…æ´¥è²¼';
                
                // å®šä½åœ¨åœ–è¡¨å³ä¸Šæ–¹
                let boxX = this.width - this.margin.right - boxWidth - 10;
                let boxY = this.margin.top + 10;
                
                this.ctx.save();
                
                // ç¹ªè£½èƒŒæ™¯æ¡†
                this.ctx.fillStyle = isDark ? 'rgba(55, 65, 81, 0.95)' : 'rgba(248, 250, 252, 0.95)';
                this.ctx.strokeStyle = '#6B7280';
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                this.ctx.stroke();
                
                // ç¹ªè£½æ–‡å­—
                this.ctx.fillStyle = isDark ? '#F3F4F6' : '#374151';
                this.ctx.font = currentLang === 'en' ? 'bold 8px sans-serif' : 'bold 9px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                const centerY = boxY + boxHeight / 2;
                
                const leftWidth = boxWidth * 0.42;
                const centerWidth = boxWidth * 0.16;
                const rightWidth = boxWidth * 0.42;
                
                // å·¦å´æ–‡å­—
                this.ctx.fillStyle = '#EF4444';
                this.ctx.fillText(gainText, boxX + leftWidth / 2, centerY);
                
                // ä¸­é–“æ¯”è¼ƒç¬¦è™Ÿ
                const symbolX = boxX + leftWidth + centerWidth / 2;
                if (this.selectedComparison) {
                    this.ctx.fillStyle = '#EF4444';
                    this.ctx.font = 'bold 13px sans-serif';
                    this.ctx.fillText(this.selectedComparison, symbolX, centerY);
                } else if (this.isDraggedToCanvas && !this.selectedComparison) {
                    this.drawFlashingHint(symbolX, centerY);
                }
                
                // å³å´æ–‡å­—
                this.ctx.fillStyle = '#EF4444';
                this.ctx.font = 'bold 9px sans-serif';
                this.ctx.fillText(lossText, boxX + leftWidth + centerWidth + rightWidth / 2, centerY);
                
                this.ctx.restore();
            }
            
            getComparisonDropZone(canvasX, canvasY) {
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                const boxWidth = currentLang === 'en' ? 200 : 130;
                const boxHeight = 32;
                
                let boxX = this.width - this.margin.right - boxWidth - 10;
                let boxY = this.margin.top + 10;
                
                // æª¢æŸ¥æ˜¯å¦åœ¨æ¯”è¼ƒæ¡†å€åŸŸå…§
                if (canvasX >= boxX && canvasX <= boxX + boxWidth && 
                    canvasY >= boxY && canvasY <= boxY + boxHeight) {
                    return 'comparison';
                }
                
                return null;
            }
            
            showComparisonDropConfirmation(symbol) {
                this.ctx.save();
                
                const message = `å·²æ”¾ç½®æ¯”è¼ƒç¬¦è™Ÿï¼š${symbol}`;
                const bgColor = '#10B981';
                
                const boxX = this.width / 2 - 80;
                const boxY = this.margin.top + 60;
                const boxWidth = 160;
                const boxHeight = 30;
                
                this.ctx.fillStyle = bgColor;
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            showComparisonDropError() {
                this.ctx.save();
                
                const message = 'è«‹æ‹–æ‹½åˆ°åœ–è¡¨å³ä¸Šæ–¹çš„æ¯”è¼ƒæ¡†ä¸­';
                const boxX = this.width / 2 - 120;
                const boxY = this.margin.top + 60;
                const boxWidth = 240;
                const boxHeight = 30;
                
                this.ctx.fillStyle = '#EF4444';
                this.ctx.beginPath();
                this.roundRect(boxX, boxY, boxWidth, boxHeight, 8);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = 'bold 11px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(message, this.width / 2, boxY + boxHeight / 2);
                
                this.ctx.restore();
                
                setTimeout(() => {
                    this.drawChart();
                }, 2000);
            }
            
            drawFlashingHint(centerX, centerY) {
                const time = Date.now() / 1000;
                const alpha = 0.3 + 0.7 * Math.abs(Math.sin(time * 3));
                
                this.ctx.save();
                this.ctx.globalAlpha = alpha;
                
                const hintWidth = 24;
                const hintHeight = 20;
                const hintX = centerX - hintWidth / 2;
                const hintY = centerY - hintHeight / 2;
                
                this.ctx.fillStyle = '#FCD34D';
                this.ctx.strokeStyle = '#F59E0B';
                this.ctx.lineWidth = 2;
                
                this.ctx.beginPath();
                this.roundRect(hintX, hintY, hintWidth, hintHeight, 4);
                this.ctx.fill();
                this.ctx.stroke();
                
                this.ctx.fillStyle = '#92400E';
                this.ctx.font = 'bold 12px sans-serif';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText('?', centerX, centerY);
                
                this.ctx.restore();
                
                if (this.isDraggedToCanvas && !this.selectedComparison) {
                    setTimeout(() => {
                        this.drawChart();
                    }, 100);
                }
            }
            
            submitAnswer() {
                // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆæ‰€æœ‰ä»»å‹™
                if (!this.selectedUnitTax || !this.selectedElasticity || !this.selectedSupplyElasticity || !this.selectedBenefit || !this.isDraggedToCanvas || !this.selectedComparison || !this.isComparisonDraggedToCanvas) {
                    const submitFeedback = document.getElementById('submitFeedback');
                    const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                    const incompleteMessage = currentLang === 'en' ? 
                        'Please complete all task selections and drag operations first.' : 
                        'è«‹å…ˆå®Œæˆæ‰€æœ‰ä»»å‹™çš„é¸æ“‡å’Œæ‹–æ‹½æ“ä½œã€‚';
                    
                    submitFeedback.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'dark:bg-green-900', 'dark:bg-red-900');
                    submitFeedback.classList.add('bg-yellow-100', 'dark:bg-yellow-900', 'text-yellow-800', 'dark:text-yellow-200');
                    submitFeedback.textContent = incompleteMessage;
                    return;
                }
                
                // è¨ˆç®—P3 (ç”Ÿç”¢è€…å¯¦éš›æ”¶åˆ°çš„åƒ¹æ ¼)
                const equilibriumP3 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ2;
                
                // è¨ˆç®—æ­£ç¢ºçš„æ´¥è²¼åˆ†äº«é¢ç©
                const consumerSubsidy = (this.equilibriumP1 - this.equilibriumP2) * this.equilibriumQ2; // (P1-P2)*Q2
                const producerSubsidy = (equilibriumP3 - this.equilibriumP1) * this.equilibriumQ2; // (P3-P1)*Q2
                
                // æ ¹æ“šé¢ç©æ¯”è¼ƒç¢ºå®šæ­£ç¢ºç­”æ¡ˆ
                const correctComparison = consumerSubsidy > producerSubsidy ? '>' : '<';
                
                // ç²å–å­¸ç”Ÿå¯¦éš›é¸æ“‡
                const studentZone = this.draggedPositions[this.selectedBenefit]?.zone;
                const studentComparison = this.selectedComparison;
                
                // åˆ¤æ–·ç­”æ¡ˆæ­£ç¢ºæ€§
                let isZoneCorrect = false;
                if (this.selectedBenefit === 'benefit') {
                    isZoneCorrect = (studentZone === 'CONSUMER_SUBSIDY_AREA');
                } else {
                    isZoneCorrect = (studentZone === 'PRODUCER_SUBSIDY_AREA');
                }
                
                const isComparisonCorrect = studentComparison === correctComparison;
                
                // é¡¯ç¤ºçµæœ
                const submitFeedback = document.getElementById('submitFeedback');
                submitFeedback.classList.remove('hidden', 'bg-yellow-100', 'dark:bg-yellow-900');
                
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                
                if (isComparisonCorrect && isZoneCorrect) {
                    submitFeedback.classList.remove('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                    submitFeedback.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    
                    const successMessage = currentLang === 'en' ? 
                        `Perfect! Consumer subsidy ${correctComparison} Producer subsidy.` : 
                        `å®Œå…¨æ­£ç¢ºï¼æ¶ˆè²»è€…ç²å¾—æ´¥è²¼ ${correctComparison} ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼ã€‚`;
                    
                    submitFeedback.textContent = successMessage;
                    
                    // æ¨™è¨˜ç•¶å‰å½ˆæ€§é¡å‹å·²å®Œæˆ
                    this.completedTasks[this.selectedElasticity] = true;
                    this.updateQuizAvailability();
                } else {
                    submitFeedback.classList.add('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                    
                    let errorMessage = currentLang === 'en' ? 'Incorrect!' : 'éŒ¯èª¤ï¼';
                    
                    if (!isComparisonCorrect) {
                        if (consumerSubsidy > producerSubsidy) {
                            if (currentLang === 'en') {
                                errorMessage += ' Consumer subsidy > Producer subsidy, should choose > symbol.';
                            } else {
                                errorMessage += ' æ¶ˆè²»è€…ç²å¾—æ´¥è²¼ > ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼ï¼Œæ‡‰è©²é¸æ“‡ > ç¬¦è™Ÿã€‚';
                            }
                        } else {
                            if (currentLang === 'en') {
                                errorMessage += ' Producer subsidy > Consumer subsidy, should choose < symbol.';
                            } else {
                                errorMessage += ' ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼ > æ¶ˆè²»è€…ç²å¾—æ´¥è²¼ï¼Œæ‡‰è©²é¸æ“‡ < ç¬¦è™Ÿã€‚';
                            }
                        }
                    }
                    
                    if (!isZoneCorrect) {
                        if (this.selectedBenefit === 'benefit') {
                            if (currentLang === 'en') {
                                errorMessage += ' "Consumer Gets Subsidy" should be placed in consumer subsidy area (P1-P2)Ã—Q2.';
                            } else {
                                errorMessage += ' "æ¶ˆè²»è€…ç²å¾—æ´¥è²¼"æ‡‰è©²æ”¾åœ¨æ¶ˆè²»è€…æ´¥è²¼å€åŸŸ (P1-P2)Ã—Q2ã€‚';
                            }
                        } else {
                            if (currentLang === 'en') {
                                errorMessage += ' "Producer Gets Subsidy" should be placed in producer subsidy area (P3-P1)Ã—Q2.';
                            } else {
                                errorMessage += ' "ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼"æ‡‰è©²æ”¾åœ¨ç”Ÿç”¢è€…æ´¥è²¼å€åŸŸ (P3-P1)Ã—Q2ã€‚';
                            }
                        }
                    }
                    
                    submitFeedback.textContent = errorMessage;
                }
            }
            
            resetAll() {
                // é‡ç½®æ‰€æœ‰é¸æ“‡
                this.selectedUnitTax = false;
                this.selectedElasticity = null;
                this.selectedSupplyElasticity = null;
                this.selectedBenefit = null;
                this.prediction = null;
                this.isDraggedToCanvas = false;
                this.draggedPositions = {};
                
                this.selectedComparison = null;
                this.isComparisonDraggedToCanvas = false;
                
                // é‡ç½®éœ€æ±‚ç·šåƒæ•¸
                this.demandSlope = -1.0;
                this.demandIntercept = 90;
                
                // é‡ç½®ä¾›çµ¦ç·šåƒæ•¸
                this.supplySlope = 1.0;
                this.supplyIntercept = this.originalSupplyIntercept;
                
                // é‡ç½®å‡è¡¡é»åƒæ•¸
                this.equilibriumP1 = null;
                this.equilibriumQ1 = null;
                this.equilibriumP2 = null;
                this.equilibriumQ2 = null;
                
                // é‡ç½®æ‰€æœ‰æŒ‰éˆ•ç‹€æ…‹
                document.querySelectorAll('.tax-btn, .elasticity-btn, .supply-elasticity-btn, .benefit-btn, .comparison-btn').forEach(btn => {
                    btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                    btn.classList.add('border-gray-300', 'dark:border-gray-600');
                });
                
                // æ¢å¾©æ‹–æ‹½æŒ‰éˆ•çš„åŸå§‹æ¨£å¼
                const benefitBtn = document.getElementById('benefit');
                const lossBtn = document.getElementById('loss');
                benefitBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                benefitBtn.classList.add('border-green-500', 'bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                lossBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                lossBtn.classList.add('border-yellow-600', 'bg-yellow-100', 'dark:bg-yellow-800', 'text-yellow-800', 'dark:text-yellow-100');
                
                // æ¢å¾©æ¯”è¼ƒç¬¦è™ŸæŒ‰éˆ•çš„åŸå§‹æ¨£å¼
                const lessThanBtn = document.getElementById('lessThan');
                const greaterThanBtn = document.getElementById('greaterThan');
                lessThanBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                lessThanBtn.classList.add('border-blue-500', 'bg-blue-100', 'dark:bg-blue-900', 'text-blue-800', 'dark:text-blue-200');
                greaterThanBtn.classList.remove('border-primary', 'bg-primary', 'text-white');
                greaterThanBtn.classList.add('border-purple-500', 'bg-purple-100', 'dark:bg-purple-900', 'text-purple-800', 'dark:text-purple-200');
                
                // éš±è—åé¥‹é¢æ¿
                document.getElementById('submitFeedback').classList.add('hidden');
                
                this.updateTaskAvailability();
                this.drawChart();
            }
            
            updateQuizAvailability() {
                const quizLockMessage = document.getElementById('quizLockMessage');
                const highElasticProgress = document.getElementById('highElasticProgress');
                const lowElasticProgress = document.getElementById('lowElasticProgress');
                
                // ç²å–ç•¶å‰èªè¨€çš„æ–‡æœ¬
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                const texts = {
                    zh: {
                        highElasticComplete: 'âœ… å·²å®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticComplete: 'âœ… å·²å®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        highElasticIncomplete: 'âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticIncomplete: 'âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹'
                    },
                    en: {
                        highElasticComplete: 'âœ… High elasticity task flow completed',
                        lowElasticComplete: 'âœ… Low elasticity task flow completed',
                        highElasticIncomplete: 'âŒ High elasticity task flow not completed',
                        lowElasticIncomplete: 'âŒ Low elasticity task flow not completed'
                    }
                };
                
                const currentTexts = texts[currentLang];
                
                // æ›´æ–°é€²åº¦é¡¯ç¤º
                if (this.completedTasks.high) {
                    highElasticProgress.innerHTML = currentTexts.highElasticComplete;
                    highElasticProgress.className = 'mt-1 text-xs text-green-600 dark:text-green-400';
                } else {
                    highElasticProgress.innerHTML = currentTexts.highElasticIncomplete;
                    highElasticProgress.className = 'mt-1 text-xs text-red-600 dark:text-red-400';
                }
                
                if (this.completedTasks.low) {
                    lowElasticProgress.innerHTML = currentTexts.lowElasticComplete;
                    lowElasticProgress.className = 'mt-1 text-xs text-green-600 dark:text-green-400';
                } else {
                    lowElasticProgress.innerHTML = currentTexts.lowElasticIncomplete;
                    lowElasticProgress.className = 'mt-1 text-xs text-red-600 dark:text-red-400';
                }
                
                // æª¢æŸ¥æ˜¯å¦å…©ç¨®å½ˆæ€§é¡å‹éƒ½å·²å®Œæˆ
                const allTasksCompleted = this.completedTasks.high && this.completedTasks.low;
                
                if (allTasksCompleted) {
                    quizLockMessage.classList.add('hidden');
                    
                    // å•Ÿç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                    const quizInputs = document.querySelectorAll('#quizSection input[type="radio"]');
                    quizInputs.forEach(input => {
                        input.disabled = false;
                        input.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
                    });
                    
                    const resetQuizBtn = document.getElementById('resetQuiz');
                    resetQuizBtn.disabled = false;
                    resetQuizBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    quizLockMessage.classList.remove('hidden');
                    
                    // ç¦ç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                    const quizInputs = document.querySelectorAll('#quizSection input[type="radio"]');
                    quizInputs.forEach(input => {
                        input.disabled = true;
                        input.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                    });
                    
                    const resetQuizBtn = document.getElementById('resetQuiz');
                    resetQuizBtn.disabled = true;
                    resetQuizBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }
            
            // åº§æ¨™è½‰æ›
            toCanvasX(x) {
                return this.margin.left + (x / 80) * this.chartWidth;
            }
            
            toCanvasY(y) {
                return this.margin.top + this.chartHeight - (y / 100) * this.chartHeight;
            }
            
            drawChart() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                const isDark = document.documentElement.classList.contains('dark');
                this.ctx.strokeStyle = isDark ? '#9CA3AF' : '#6B7280';
                this.ctx.fillStyle = isDark ? '#F3F4F6' : '#374151';
                this.ctx.font = '12px sans-serif';
                
                this.drawAxes();
                this.drawDemandLine();
                this.drawSupplyLine();
                this.drawPriceChangeIndicators();
                this.drawComparisonBox();
                this.drawDemandLineHint(); // æ·»åŠ éœ€æ±‚ç·šæ‹–æ‹½æç¤º
                
                // ç¹ªè£½æ‰€æœ‰æ‹–æ‹½æ¨™ç±¤
                this.drawDraggedLabels();
            }
            
            drawDemandLineHint() {
                // åªæœ‰åœ¨é¸æ“‡å½ˆæ€§é¡å‹ä½†é‚„æ²’é¸æ“‡ä¾›çµ¦å½ˆæ€§æ™‚é¡¯ç¤ºæç¤º
                if (this.selectedUnitTax && this.selectedElasticity && !this.selectedSupplyElasticity) {
                    const hintX = this.width / 2;
                    const hintY = this.margin.top + 50;
                    
                    // é–ƒçˆæ•ˆæœ
                    const time = Date.now() / 1000;
                    const alpha = 0.4 + 0.6 * Math.abs(Math.sin(time * 2));
                    
                    this.ctx.save();
                    this.ctx.globalAlpha = alpha;
                    
                    // æç¤ºæ¡†èƒŒæ™¯
                    const hintWidth = 200;
                    const hintHeight = 40;
                    const hintBoxX = hintX - hintWidth / 2;
                    const hintBoxY = hintY - hintHeight / 2;
                    
                    this.ctx.fillStyle = '#FEF3C7';
                    this.ctx.strokeStyle = '#F59E0B';
                    this.ctx.lineWidth = 2;
                    
                    this.ctx.beginPath();
                    this.roundRect(hintBoxX, hintBoxY, hintWidth, hintHeight, 8);
                    this.ctx.fill();
                    this.ctx.stroke();
                    
                    // æç¤ºæ–‡å­—
                    this.ctx.fillStyle = '#92400E';
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    this.ctx.fillText('ğŸ’¡ æ‹–æ‹½è—è‰²éœ€æ±‚ç·šèª¿æ•´å½ˆæ€§', hintX, hintY - 5);
                    this.ctx.font = '10px sans-serif';
                    this.ctx.fillText('(æˆ–ç›´æ¥é¸æ“‡å½ˆæ€§é¡å‹)', hintX, hintY + 8);
                    
                    this.ctx.restore();
                    
                    // ç¹¼çºŒé–ƒçˆ
                    setTimeout(() => {
                        if (this.selectedUnitTax && this.selectedElasticity && !this.selectedSupplyElasticity) {
                            this.drawChart();
                        }
                    }, 100);
                }
            }
            
            hideHint() {
                // éš±è—æç¤ºçš„åŠŸèƒ½ï¼ˆç•¶é–‹å§‹æ‹–æ‹½æ™‚èª¿ç”¨ï¼‰
                // é€™è£¡ä¸»è¦æ˜¯ç‚ºäº†åœæ­¢é–ƒçˆå¾ªç’°
            }
            
            drawAxes() {
                this.ctx.beginPath();
                
                // Yè»¸
                this.ctx.moveTo(this.margin.left, this.margin.top);
                this.ctx.lineTo(this.margin.left, this.height - this.margin.bottom);
                
                // Xè»¸
                this.ctx.moveTo(this.margin.left, this.height - this.margin.bottom);
                this.ctx.lineTo(this.width - this.margin.right, this.height - this.margin.bottom);
                
                this.ctx.stroke();
                
                // æ¨™ç±¤
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                const priceLabel = currentLang === 'en' ? 'Price' : 'åƒ¹æ ¼';
                const quantityLabel = currentLang === 'en' ? 'Quantity' : 'æ•¸é‡';
                this.ctx.fillText(priceLabel, this.margin.left - 40, this.margin.top - 10);
                this.ctx.fillText(quantityLabel, this.width - this.margin.right + 10, this.height - this.margin.bottom + 15);
            }
            
            drawDemandLine() {
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#3B82F6';
                this.ctx.lineWidth = 3;
                
                // Yè»¸äº¤é»
                const yAxisIntercept = this.demandIntercept;
                // Xè»¸äº¤é»
                let xAxisIntercept = -this.demandIntercept / this.demandSlope;
                
                if (!isFinite(xAxisIntercept)) {
                    xAxisIntercept = 10000;
                }
                
                // ç¢ºå®šç¹ªè£½ç¯„åœ
                let startX = 0;
                let startY = yAxisIntercept;
                let endX = Math.min(80, Math.max(0, xAxisIntercept));
                let endY = 0;
                
                if (startY > 100) {
                    startY = 100;
                    startX = Math.max(0, (100 - this.demandIntercept) / this.demandSlope);
                }
                if (startY < 0) {
                    startY = 0;
                    startX = Math.max(0, (0 - this.demandIntercept) / this.demandSlope);
                }
                
                if (xAxisIntercept > 80 || xAxisIntercept < 0) {
                    endX = 80;
                    endY = this.demandIntercept + this.demandSlope * 80;
                    endY = Math.min(100, Math.max(0, endY));
                }
                
                startX = Math.max(0, Math.min(80, startX));
                startY = Math.min(100, Math.max(0, startY));
                endX = Math.max(0, Math.min(80, endX));
                endY = Math.min(100, Math.max(0, endY));
                
                this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                this.ctx.stroke();
                
                // éœ€æ±‚ç·šæ¨™ç±¤
                this.ctx.fillStyle = '#3B82F6';
                this.ctx.font = 'bold 16px sans-serif';
                
                let dX = endX + 3;
                let dY = endY - 5;
                
                dX = Math.min(78, Math.max(2, dX));
                dY = Math.min(98, Math.max(12, dY));
                
                this.ctx.fillText('D', this.toCanvasX(dX), this.toCanvasY(dY));
                
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px sans-serif';
            }
            
            drawSupplyLine() {
                // å…ˆç¹ªè£½åŸå§‹ä¾›çµ¦ç·šS1ï¼ˆå¦‚æœé¸æ“‡äº†å¾é‡æ´¥è²¼ï¼‰
                if (this.selectedUnitTax) {
                    this.drawOriginalSupplyLine();
                }
                
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#EF4444';
                this.ctx.lineWidth = 3;
                
                // ç¹ªè£½ç•¶å‰ä¾›çµ¦ç·š
                const currentIntercept = this.selectedUnitTax ? this.supplyIntercept : this.originalSupplyIntercept;
                
                const yAxisIntercept = currentIntercept;
                
                let startX = 0;
                let startY = yAxisIntercept;
                let endX = 80;
                let endY = currentIntercept + this.supplySlope * 80;
                
                if (startY < 0) {
                    startY = 0;
                    startX = Math.max(0, (0 - currentIntercept) / this.supplySlope);
                }
                if (startY > 100) {
                    startY = 100;
                    startX = Math.max(0, (100 - currentIntercept) / this.supplySlope);
                }
                
                if (endY > 100) {
                    endY = 100;
                    endX = Math.max(0, (100 - currentIntercept) / this.supplySlope);
                }
                if (endY < 0) {
                    endY = 0;
                    endX = Math.max(0, (0 - currentIntercept) / this.supplySlope);
                }
                
                startX = Math.max(0, Math.min(80, startX));
                startY = Math.min(100, Math.max(0, startY));
                endX = Math.max(0, Math.min(80, endX));
                endY = Math.min(100, Math.max(0, endY));
                
                this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                this.ctx.stroke();
                
                // ä¾›çµ¦ç·šæ¨™ç±¤
                this.ctx.fillStyle = '#EF4444';
                this.ctx.font = 'bold 16px sans-serif';
                
                let sX = endX + 1;
                let sY = endY + 5;
                
                sX = Math.min(78, Math.max(2, sX));
                sY = Math.min(98, Math.max(12, sY));
                
                const sLabel = this.selectedUnitTax ? 'S2' : 'S1';
                this.ctx.fillText(sLabel, this.toCanvasX(sX), this.toCanvasY(sY));
                
                // ç¹ªè£½å‡è¡¡é»å’Œç®­é ­
                if (this.selectedUnitTax) {
                    this.drawEquilibriumChanges();
                }
                
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px sans-serif';
            }
            
            drawOriginalSupplyLine() {
                this.ctx.beginPath();
                this.ctx.strokeStyle = '#EF4444';
                this.ctx.lineWidth = 2;
                
                const yAxisIntercept = this.originalSupplyIntercept;
                
                let startX = 0;
                let startY = yAxisIntercept;
                let endX = 80;
                let endY = this.originalSupplyIntercept + this.supplySlope * 80;
                
                if (startY < 0) {
                    startY = 0;
                    startX = Math.max(0, (0 - this.originalSupplyIntercept) / this.supplySlope);
                }
                if (startY > 100) {
                    startY = 100;
                    startX = Math.max(0, (100 - this.originalSupplyIntercept) / this.supplySlope);
                }
                
                if (endY > 100) {
                    endY = 100;
                    endX = Math.max(0, (100 - this.originalSupplyIntercept) / this.supplySlope);
                }
                if (endY < 0) {
                    endY = 0;
                    endX = Math.max(0, (0 - this.originalSupplyIntercept) / this.supplySlope);
                }
                
                startX = Math.max(0, Math.min(80, startX));
                startY = Math.min(100, Math.max(0, startY));
                endX = Math.max(0, Math.min(80, endX));
                endY = Math.min(100, Math.max(0, endY));
                
                this.ctx.moveTo(this.toCanvasX(startX), this.toCanvasY(startY));
                this.ctx.lineTo(this.toCanvasX(endX), this.toCanvasY(endY));
                this.ctx.stroke();
                
                // S1æ¨™ç±¤
                this.ctx.fillStyle = '#EF4444';
                this.ctx.font = 'bold 16px sans-serif';
                let s1X = endX + 1;
                let s1Y = endY + 5;
                s1X = Math.min(78, Math.max(2, s1X));
                s1Y = Math.min(98, Math.max(12, s1Y));
                this.ctx.fillText('S1', this.toCanvasX(s1X), this.toCanvasY(s1Y));
            }
            
            drawEquilibriumChanges() {
                const arrowColor = '#F97316';
                const arrowSize = 8;
                
                // ç¹ªè£½å‡è¡¡é»
                this.ctx.fillStyle = '#000000';
                
                // åŸå§‹å‡è¡¡é»E1
                if (this.equilibriumP1 && this.equilibriumQ1) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1), 4, 0, 2 * Math.PI);
                    this.ctx.fill();
                    
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.fillText('E1', this.toCanvasX(this.equilibriumQ1) + 6, this.toCanvasY(this.equilibriumP1) - 6);
                }
                
                // æ–°å‡è¡¡é»E2
                if (this.equilibriumP2 && this.equilibriumQ2) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2), 4, 0, 2 * Math.PI);
                    this.ctx.fill();
                    
                    this.ctx.fillText('E2', this.toCanvasX(this.equilibriumQ2) + 6, this.toCanvasY(this.equilibriumP2) - 6);
                }
                
                // è¨­ç½®æ©™è‰²ç®­é ­æ¨£å¼
                this.ctx.strokeStyle = arrowColor;
                this.ctx.lineWidth = 3;
                
                // S1â†’S2ç®­é ­ï¼ˆä¾›çµ¦ç·šå‘ä¸‹ç§»å‹•ï¼‰
                if (this.equilibriumP1 && this.equilibriumQ1) {
                    const s1s2ArrowX = this.toCanvasX(this.equilibriumQ1);
                    const xPosition = this.equilibriumQ1;
                    const s1LineY = this.originalSupplyIntercept + this.supplySlope * xPosition;
                    const s2LineY = this.supplyIntercept + this.supplySlope * xPosition;
                    
                    const s1LineCanvasY = this.toCanvasY(s1LineY);
                    const s2LineCanvasY = this.toCanvasY(s2LineY);
                    
                    const lineGap = 5;
                    
                    const s1s2StartY = s1LineCanvasY + lineGap;
                    const s1s2EndY = s2LineCanvasY - lineGap;
                    
                    // å‚ç›´ç®­é ­ç·š
                    this.ctx.beginPath();
                    this.ctx.moveTo(s1s2ArrowX, s1s2StartY);
                    this.ctx.lineTo(s1s2ArrowX, s1s2EndY);
                    this.ctx.stroke();
                    
                    // å‘ä¸‹ç®­é ­é ­éƒ¨
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(s1s2ArrowX, s1s2EndY);
                    this.ctx.lineTo(s1s2ArrowX - arrowSize/2, s1s2EndY - arrowSize);
                    this.ctx.lineTo(s1s2ArrowX + arrowSize/2, s1s2EndY - arrowSize);
                    this.ctx.closePath();
                    this.ctx.fill();
                }
                
                // P1â†’P2ç®­é ­ï¼ˆåƒ¹æ ¼ä¸‹é™ï¼‰
                if (this.equilibriumP1 && this.equilibriumP2) {
                    const p1p2ArrowX = this.margin.left - 20;
                    const p1p2StartY = this.toCanvasY(this.equilibriumP1);
                    const p1p2EndY = this.toCanvasY(this.equilibriumP2);
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(p1p2ArrowX, p1p2StartY);
                    this.ctx.lineTo(p1p2ArrowX, p1p2EndY);
                    this.ctx.stroke();
                    
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(p1p2ArrowX, p1p2EndY);
                    this.ctx.lineTo(p1p2ArrowX - arrowSize/2, p1p2EndY - arrowSize);
                    this.ctx.lineTo(p1p2ArrowX + arrowSize/2, p1p2EndY - arrowSize);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    // P1ã€P2ã€P3æ¨™è¨»
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'right';
                    this.ctx.fillStyle = '#000000';
                    this.ctx.fillText('P1', p1p2ArrowX - 5, p1p2StartY + 4);
                    this.ctx.fillText('P2', p1p2ArrowX - 5, p1p2EndY + 4);
                    
                    const equilibriumP3 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ2;
                    this.ctx.fillText('P3', this.margin.left - 25, this.toCanvasY(equilibriumP3) + 4);
                    
                    this.ctx.textAlign = 'left';
                }
                
                // Q1â†’Q2ç®­é ­ï¼ˆæ•¸é‡å¢åŠ ï¼‰
                if (this.equilibriumQ1 && this.equilibriumQ2) {
                    const q1q2ArrowY = this.height - this.margin.bottom + 20;
                    const q1q2StartX = this.toCanvasX(this.equilibriumQ1);
                    const q1q2EndX = this.toCanvasX(this.equilibriumQ2);
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(q1q2StartX, q1q2ArrowY);
                    this.ctx.lineTo(q1q2EndX, q1q2ArrowY);
                    this.ctx.stroke();
                    
                    this.ctx.fillStyle = arrowColor;
                    this.ctx.beginPath();
                    this.ctx.moveTo(q1q2EndX, q1q2ArrowY);
                    this.ctx.lineTo(q1q2EndX - arrowSize, q1q2ArrowY - arrowSize/2);
                    this.ctx.lineTo(q1q2EndX - arrowSize, q1q2ArrowY + arrowSize/2);
                    this.ctx.closePath();
                    this.ctx.fill();
                    
                    this.ctx.font = 'bold 12px sans-serif';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillStyle = '#000000';
                    this.ctx.fillText('Q1', q1q2StartX, q1q2ArrowY + 20);
                    this.ctx.fillText('Q2', q1q2EndX, q1q2ArrowY + 20);
                    this.ctx.textAlign = 'left';
                }
                
                this.ctx.lineWidth = 1;
                this.ctx.fillStyle = '#000000';
            }
            
            drawPriceChangeIndicators() {
                if (!this.selectedUnitTax) return;
                
                if (!this.equilibriumP1 || !this.equilibriumQ1 || !this.equilibriumP2 || !this.equilibriumQ2) return;
                
                // ç¹ªè£½è™›ç·š
                this.ctx.setLineDash([5, 5]);
                this.ctx.strokeStyle = '#9CA3AF';
                this.ctx.lineWidth = 2;
                
                // P1æ°´å¹³ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(this.equilibriumP1));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1));
                this.ctx.stroke();
                
                // Q1å‚ç›´ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(this.equilibriumP1));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ1), this.toCanvasY(0));
                this.ctx.stroke();
                
                // P2æ°´å¹³ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(this.equilibriumP2));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2));
                this.ctx.stroke();
                
                // è¨ˆç®—ä¸¦ç¹ªè£½P3ç·š
                const equilibriumP3 = this.originalSupplyIntercept + this.supplySlope * this.equilibriumQ2;
                
                // Q2å‚ç›´ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(0));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2));
                this.ctx.stroke();
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(this.equilibriumP2));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(equilibriumP3));
                this.ctx.stroke();
                
                // P3æ°´å¹³ç·š
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(0), this.toCanvasY(equilibriumP3));
                this.ctx.lineTo(this.toCanvasX(this.equilibriumQ2), this.toCanvasY(equilibriumP3));
                this.ctx.stroke();
                
                this.ctx.setLineDash([]);
                this.ctx.lineWidth = 1;
            }
            
            roundRect(x, y, width, height, radius) {
                this.ctx.beginPath();
                this.ctx.moveTo(x + radius, y);
                this.ctx.lineTo(x + width - radius, y);
                this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                this.ctx.lineTo(x + width, y + height - radius);
                this.ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                this.ctx.lineTo(x + radius, y + height);
                this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                this.ctx.lineTo(x, y + radius);
                this.ctx.quadraticCurveTo(x, y, x + radius, y);
                this.ctx.closePath();
            }
            
            setupCanvasEvents() {
                // é¼ æ¨™äº‹ä»¶
                this.canvas.addEventListener('mousedown', (e) => this.handleStart(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.handleEnd(e));
                this.canvas.addEventListener('mouseleave', (e) => this.handleEnd(e));
                
                // è§¸æ‘¸äº‹ä»¶
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleStart(e.touches[0]);
                });
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleMove(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.handleEnd(e);
                });
            }
            
            getEventPos(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }
            
            handleStart(e) {
                const pos = this.getEventPos(e);
                
                // æª¢æŸ¥æ˜¯å¦é»æ“Šåœ¨éœ€æ±‚ç·šé™„è¿‘
                if (this.isNearDemandLine(pos.x, pos.y)) {
                    this.isDragging = true;
                    this.dragPoint = pos;
                    this.canvas.style.cursor = 'grabbing';
                    
                    // é–‹å§‹æ‹–æ‹½æ™‚éš±è—æç¤ºæ¡†
                    this.hideHint();
                }
            }
            
            handleMove(e) {
                const pos = this.getEventPos(e);
                
                if (this.isDragging) {
                    // è¨ˆç®—æ–°çš„æ–œç‡
                    this.updateDemandSlope(pos);
                    this.drawChart();
                } else {
                    // æª¢æŸ¥æ˜¯å¦åœ¨éœ€æ±‚ç·šé™„è¿‘ï¼Œæ”¹è®Šæ¸¸æ¨™
                    if (this.isNearDemandLine(pos.x, pos.y)) {
                        this.canvas.style.cursor = 'grab';
                    } else {
                        this.canvas.style.cursor = 'default';
                    }
                }
            }
            
            handleEnd(e) {
                if (this.isDragging) {
                    // æ¨™è¨˜éœ€æ±‚ç·šå·²è¢«ä¿®æ”¹ï¼Œå•Ÿç”¨ä»»å‹™4
                    this.hasModifiedDemandLine = true;
                    this.updateTaskAvailability();
                }
                this.isDragging = false;
                this.dragPoint = null;
                this.canvas.style.cursor = 'default';
            }
            
            isNearDemandLine(canvasX, canvasY) {
                // è½‰æ›åˆ°ç¶“æ¿Ÿåº§æ¨™
                const economicX = ((canvasX - this.margin.left) / this.chartWidth) * 80;
                const economicY = ((this.height - this.margin.bottom - canvasY) / this.chartHeight) * 100;
                
                // å°æ–¼æ¥è¿‘æ°´å¹³çš„ç·šæ¢ï¼Œä½¿ç”¨ç‰¹æ®Šæª¢æ¸¬
                if (Math.abs(this.demandSlope) < 0.001) {
                    // æ°´å¹³ç·šæª¢æ¸¬ï¼šæª¢æŸ¥æ˜¯å¦æ¥è¿‘åŸºæº–é»çš„Yå€¼
                    const distance = Math.abs(economicY - this.basePrice);
                    return distance < 10 && economicX >= 0 && economicX <= 80;
                } else {
                    // æ­£å¸¸ç·šæ¢æª¢æ¸¬
                    const lineY = this.demandIntercept + this.demandSlope * economicX;
                    const distance = Math.abs(economicY - lineY);
                    
                    return distance < 10 && 
                           economicX >= 0 && economicX <= 80 && 
                           economicY >= 0 && economicY <= 100;
                }
            }
            
            updateDemandSlope(pos) {
                // è½‰æ›åˆ°ç¶“æ¿Ÿåº§æ¨™
                const economicX = ((pos.x - this.margin.left) / this.chartWidth) * 80;
                const economicY = ((this.height - this.margin.bottom - pos.y) / this.chartHeight) * 100;
                
                // è¨ˆç®—æ–°æ–œç‡ï¼ˆä¿æŒé€šéåŸºæº–é»ï¼‰
                if (Math.abs(economicX - this.baseQuantity) > 0.1) {
                    const newSlope = (economicY - this.basePrice) / (economicX - this.baseQuantity);
                    // é™åˆ¶æ–œç‡ç¯„åœï¼šå¾æ¥è¿‘æ°´å¹³(0åº¦)åˆ°æ¥è¿‘å‚ç›´(90åº¦)
                    this.demandSlope = Math.max(-1000, Math.min(-0.00001, newSlope));
                    
                    // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœç”¨æˆ¶æ‹–æ‹½åˆ°æ¥è¿‘æ°´å¹³ä½ç½®ï¼ˆYå€¼è®ŠåŒ–å¾ˆå°ï¼‰
                    const yDiff = Math.abs(economicY - this.basePrice);
                    if (yDiff < 5) {
                        this.demandSlope = -0.00001; // å¼·åˆ¶è¨­ç‚ºæ¥è¿‘æ°´å¹³
                    }
                    
                    // é‡æ–°è¨ˆç®—æˆªè·
                    this.demandIntercept = this.basePrice - this.demandSlope * this.baseQuantity;
                    
                    // é‡è¦ï¼šå¦‚æœå·²é¸æ“‡å¾é‡æ´¥è²¼ï¼Œé‡æ–°è¨ˆç®—å‡è¡¡é»
                    if (this.selectedUnitTax) {
                        this.calculateOriginalEquilibrium();
                        this.calculateNewEquilibrium();
                    }
                }
            }
        }
        
        // ç·´ç¿’é¡Œç®¡ç†é¡
        class QuizManager {
            constructor() {
                this.questions = {
                    q1: { correct: 'demand_more_elastic', answered: false },
                    q2: { correct: 'consumer_gains_more', answered: false }, // é¸é …Aï¼šæ¶ˆè²»è€…ç²å¾—è¼ƒå¤šæ´¥è²¼
                    q3: { correct: 'elasticity_ratio', answered: false },
                    q4: { correct: 'uncertain', answered: false },          // ç”Ÿç”¢è€…æ´¥è²¼å‰æ”¶å…¥ï¼šä¸èƒ½ç¢ºå®š
                    q5: { correct: 'increase', answered: false },           // ç”Ÿç”¢è€…æ´¥è²¼å¾Œæ”¶å…¥ï¼šå¢åŠ 
                    q6: { correct: 'increase', answered: false },           // é«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…æ´¥è²¼å‰æ”¶å…¥ï¼šå¢åŠ 
                    q7: { correct: 'increase', answered: false },           // é«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…æ´¥è²¼å¾Œæ”¶å…¥ï¼šå¢åŠ 
                    q8: { correct: 'increase', answered: false },           // é«˜å½ˆæ€§éœ€æ±‚ä¸‹æ¶ˆè²»è€…ç¸½æ”¯å‡ºï¼šå¢åŠ 
                    q9: { correct: 'uncertain_ratio', answered: false }     // é«˜å½ˆæ€§éœ€æ±‚ä¸‹æ´¥è²¼åˆ†æ“”ï¼šä¸èƒ½ç¢ºå®šé›™æ–¹ç²å¾—æ¯”ä¾‹
                };
                this.score = 0;
                this.init();
            }
            
            init() {
                // åˆå§‹ç‹€æ…‹ï¼šç¦ç”¨æ‰€æœ‰ç·´ç¿’é¡Œ
                this.initializeQuizState();
                
                // ç‚ºæ¯å€‹é¡Œç›®æ·»åŠ äº‹ä»¶ç›£è½å™¨
                Object.keys(this.questions).forEach(questionId => {
                    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                    radios.forEach(radio => {
                        radio.addEventListener('change', () => {
                            this.checkAnswer(questionId, radio.value);
                        });
                    });
                });
                
                // é‡æ–°ä½œç­”æŒ‰éˆ•
                document.getElementById('resetQuiz').addEventListener('click', () => {
                    this.resetQuiz();
                });
            }
            
            initializeQuizState() {
                const quizInputs = document.querySelectorAll('#quizSection input[type="radio"]');
                
                quizInputs.forEach(input => {
                    input.disabled = true;
                    input.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
                });
                
                const resetQuizBtn = document.getElementById('resetQuiz');
                resetQuizBtn.disabled = true;
                resetQuizBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            checkAnswer(questionId, selectedValue) {
                const question = this.questions[questionId];
                const feedbackDiv = document.getElementById(`feedback${questionId.slice(-1)}`);
                const isCorrect = selectedValue === question.correct;
                
                if (!question.answered) {
                    question.answered = true;
                    if (isCorrect) {
                        this.score++;
                    }
                }
                
                feedbackDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'dark:bg-green-900', 'dark:bg-red-900');
                
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                const correctText = currentLang === 'en' ? 'âœ“ Correct!' : 'âœ“ æ­£ç¢ºï¼';
                const incorrectText = currentLang === 'en' ? 'âœ— Incorrect.' : 'âœ— éŒ¯èª¤ã€‚';
                
                if (isCorrect) {
                    feedbackDiv.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200');
                    feedbackDiv.innerHTML = `<strong>${correctText}</strong> ${this.getExplanation(questionId)}`;
                } else {
                    feedbackDiv.classList.add('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200');
                    feedbackDiv.innerHTML = `<strong>${incorrectText}</strong> ${this.getExplanation(questionId)}`;
                }
                
                this.updateTotalScore();
            }
            
            getExplanation(questionId) {
                const currentLang = window.languageManager ? window.languageManager.currentLang : 'zh';
                
                const explanations = {
                    zh: {
                        q1: 'ç•¶æ¶ˆè²»è€…ç²å¾—æ´¥è²¼è¼ƒç”Ÿç”¢è€…å°‘æ™‚ï¼Œè¡¨ç¤ºæ¶ˆè²»è€…å°åƒ¹æ ¼è®ŠåŒ–è¼ƒæ•æ„Ÿï¼ˆéœ€æ±‚å½ˆæ€§è¼ƒå¤§ï¼‰ï¼Œè€Œç”Ÿç”¢è€…è¼ƒä¸æ•æ„Ÿï¼ˆä¾›çµ¦å½ˆæ€§è¼ƒå°ï¼‰ã€‚æ ¹æ“šæ´¥è²¼åˆ†äº«ç†è«–ï¼Œå½ˆæ€§è¼ƒå¤§çš„ä¸€æ–¹ç²å¾—è¼ƒå°‘æ´¥è²¼ã€‚',
                        q2: 'ç•¶éœ€æ±‚å½ˆæ€§ä½æ–¼ä¾›çµ¦å½ˆæ€§æ™‚ï¼Œæ¶ˆè²»è€…å°åƒ¹æ ¼è®ŠåŒ–è¼ƒä¸æ•æ„Ÿï¼ˆéœ€æ±‚ç„¡å½ˆæ€§ï¼‰ï¼Œç”Ÿç”¢è€…ç›¸å°æ›´æœ‰å½ˆæ€§ï¼Œå› æ­¤æ¶ˆè²»è€…ç²å¾—è¼ƒå¤šæ´¥è²¼ã€‚æ´¥è²¼åˆ†äº«çš„åŸå‰‡æ˜¯ï¼šå½ˆæ€§è¼ƒä½çš„ä¸€æ–¹ç²å¾—è¼ƒå¤šæ´¥è²¼ã€‚',
                        q3: 'æ´¥è²¼åˆ†äº«çš„é—œéµåœ¨æ–¼é›™æ–¹çš„åƒ¹æ ¼æ•æ„Ÿåº¦ã€‚å½ˆæ€§è¼ƒä½çš„ä¸€æ–¹ï¼ˆè¼ƒç„¡é¸æ“‡é¤˜åœ°ï¼‰æœƒç²å¾—è¼ƒå¤šæ´¥è²¼ï¼Œèˆ‡æ´¥è²¼é¡åº¦å¤§å°æˆ–æ”¿åºœæ”¿ç­–ç„¡é—œã€‚',
                        q4: 'æ´¥è²¼å‰æ”¶å…¥ = æ¶ˆè²»è€…æ”¯ä»˜åƒ¹æ ¼ Ã— æ•¸é‡ã€‚é›–ç„¶æ•¸é‡å¢åŠ ï¼Œä½†æ¶ˆè²»è€…æ”¯ä»˜çš„åƒ¹æ ¼ä¸‹é™ç¨‹åº¦é€šå¸¸è¼ƒå¤§ï¼Œå› æ­¤æ´¥è²¼å‰æ”¶å…¥æœƒæ¸›å°‘ã€‚',
                        q5: 'æ´¥è²¼å¾Œæ”¶å…¥ = (æ¶ˆè²»è€…æ”¯ä»˜åƒ¹æ ¼ + æ´¥è²¼) Ã— æ•¸é‡ã€‚ç”Ÿç”¢è€…å¯¦éš›æ”¶åˆ°çš„åƒ¹æ ¼ä¸Šå‡ï¼Œæ•¸é‡ä¹Ÿå¢åŠ ï¼Œå› æ­¤æ´¥è²¼å¾Œæ”¶å…¥å¿…å®šå¢åŠ ã€‚',
                        q6: 'é«˜å½ˆæ€§éœ€æ±‚ä¸‹ï¼Œåƒ¹æ ¼ä¸‹é™æœƒå°è‡´æ•¸é‡å¤§å¹…å¢åŠ ã€‚æ´¥è²¼å‰æ”¶å…¥çš„è®ŠåŒ–å–æ±ºæ–¼åƒ¹æ ¼ä¸‹é™èˆ‡æ•¸é‡å¢åŠ çš„ç›¸å°å¹…åº¦ï¼Œçµæœä¸èƒ½ç¢ºå®šã€‚',
                        q7: 'é«˜å½ˆæ€§éœ€æ±‚ä¸‹ï¼Œç”Ÿç”¢è€…æ´¥è²¼å¾Œæ”¶å…¥ = (æ›´é«˜çš„å¯¦éš›åƒ¹æ ¼) Ã— (å¤§å¹…å¢åŠ çš„æ•¸é‡)ï¼Œå…©å€‹å› ç´ éƒ½å°æ”¶å…¥å¢åŠ æœ‰åˆ©ï¼Œå› æ­¤å¿…å®šå¢åŠ ã€‚',
                        q8: 'é«˜å½ˆæ€§éœ€æ±‚ä¸‹ï¼Œæ¶ˆè²»è€…æ”¯å‡º = (è¼ƒä½åƒ¹æ ¼) Ã— (å¤§å¹…å¢åŠ æ•¸é‡)ã€‚ç”±æ–¼éœ€æ±‚é«˜å½ˆæ€§ï¼Œæ•¸é‡å¢åŠ å¹…åº¦å¤§æ–¼åƒ¹æ ¼ä¸‹é™å¹…åº¦ï¼Œç¸½æ”¯å‡ºæœƒå¢åŠ ã€‚',
                        q9: 'é«˜å½ˆæ€§éœ€æ±‚æ„å‘³è‘—æ¶ˆè²»è€…å°åƒ¹æ ¼æ•æ„Ÿï¼Œå› æ­¤ç²å¾—è¼ƒå°‘æ´¥è²¼ã€‚ç›¸å°åœ°ï¼Œç”Ÿç”¢è€…ï¼ˆä¾›çµ¦æ–¹ï¼‰ç²å¾—è¼ƒå¤šæ´¥è²¼ï¼Œé€™ç¬¦åˆå½ˆæ€§åˆ†äº«åŸç†ã€‚'
                    },
                    en: {
                        q1: 'When consumers receive less subsidy than producers, it means consumers are more sensitive to price changes (higher demand elasticity) while producers are less sensitive (lower supply elasticity). According to subsidy sharing theory, the party with higher elasticity receives less subsidy.',
                        q2: 'When demand elasticity is lower than supply elasticity, consumers are less sensitive to price changes (inelastic demand) while producers are relatively more elastic, so consumers receive more subsidy. The principle of subsidy sharing is: the party with lower elasticity receives more subsidy.',
                        q3: 'The key to subsidy sharing lies in the price sensitivity of both parties. The party with lower elasticity (less choice flexibility) receives more subsidy, regardless of the subsidy amount or government policy.',
                        q4: 'Pre-subsidy revenue = Consumer payment price Ã— Quantity. Although quantity increases, the consumer payment price typically decreases more significantly, so pre-subsidy revenue decreases.',
                        q5: 'Post-subsidy revenue = (Consumer payment price + Subsidy) Ã— Quantity. The actual price received by producers increases, and quantity also increases, so post-subsidy revenue definitely increases.',
                        q6: 'Under high elastic demand, price decreases lead to significant quantity increases. The change in pre-subsidy revenue depends on the relative magnitude of price decrease versus quantity increase, making the result uncertain.',
                        q7: 'Under high elastic demand, producer post-subsidy revenue = (Higher actual price) Ã— (Significantly increased quantity). Both factors favor revenue increase, so it definitely increases.',
                        q8: 'Under high elastic demand, consumer expenditure = (Lower price) Ã— (Significantly increased quantity). Due to high demand elasticity, the quantity increase exceeds the price decrease, so total expenditure increases.',
                        q9: 'High elastic demand means consumers are price-sensitive, thus receiving less subsidy. Relatively, producers (supply side) receive more subsidy, which aligns with elasticity sharing principles.'
                    }
                };
                
                return explanations[currentLang][questionId];
            }
            
            updateTotalScore() {
                const totalQuestions = Object.keys(this.questions).length; // ç¸½é¡Œæ•¸ï¼š9é¡Œ
                const answeredCount = Object.values(this.questions).filter(q => q.answered).length;
                const totalScoreDiv = document.getElementById('totalScore');
                
                if (answeredCount === totalQuestions) {
                    const percentage = Math.round((this.score / totalQuestions) * 100);
                    let grade = '';
                    let color = '';
                    
                    if (percentage >= 90) {
                        grade = 'å„ªç§€';
                        color = 'text-green-600 dark:text-green-400';
                    } else if (percentage >= 80) {
                        grade = 'è‰¯å¥½';
                        color = 'text-blue-600 dark:text-blue-400';
                    } else if (percentage >= 70) {
                        grade = 'åŠæ ¼';
                        color = 'text-yellow-600 dark:text-yellow-400';
                    } else {
                        grade = 'éœ€åŠ å¼·';
                        color = 'text-red-600 dark:text-red-400';
                    }
                    
                    totalScoreDiv.innerHTML = `
                        <div class="text-xl font-bold ${color}">
                            ç¸½åˆ†ï¼š${this.score}/${totalQuestions} (${percentage}%) - ${grade}
                        </div>
                    `;
                } else {
                    totalScoreDiv.innerHTML = `å·²å®Œæˆ ${answeredCount}/${totalQuestions} é¡Œï¼Œç›®å‰å¾—åˆ†ï¼š${this.score} åˆ†`;
                    totalScoreDiv.className = 'text-lg font-semibold text-blue-800 dark:text-blue-200';
                }
            }
            
            resetQuiz() {
                Object.keys(this.questions).forEach(questionId => {
                    this.questions[questionId].answered = false;
                    
                    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                    radios.forEach(radio => {
                        radio.checked = false;
                    });
                    
                    const feedbackDiv = document.getElementById(`feedback${questionId.slice(-1)}`);
                    feedbackDiv.classList.add('hidden');
                });
                
                this.score = 0;
                
                const totalScoreDiv = document.getElementById('totalScore');
                totalScoreDiv.textContent = 'å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†';
                totalScoreDiv.className = 'text-lg font-semibold text-blue-800 dark:text-blue-200';
            }
        }
        
        // å¤šèªè¨€æ”¯æŒ
        class LanguageManager {
            constructor() {
                this.currentLang = 'zh';
                this.texts = {
                    zh: {
                        mainTitle: 'å¾é‡æ´¥è²¼ VS éœ€æ±‚å½ˆæ€§ã€ä¾›çµ¦å½ˆæ€§äº’å‹•æ•™å­¸',
                        task1Label: 'ä»»å‹™1ï¼šå¾é‡æ´¥è²¼',
                        task2Label: 'ä»»å‹™2ï¼šéœ€æ±‚å½ˆæ€§é¡å‹',
                        task3Label: 'ä»»å‹™3ï¼šä¾›çµ¦å½ˆæ€§é¡å‹',
                        task4Label: 'ä»»å‹™4ï¼šæ‹–æ‹½åˆ°åœ–è¡¨',
                        task5Label: 'ä»»å‹™5ï¼šæ‹–æ‹½åˆ°åœ–è¡¨',
                        task6Label: 'ä»»å‹™6ï¼šæäº¤',
                        resetLabel: 'é‡æ–°é–‹å§‹',
                        unitSubsidyText: 'å¾é‡æ´¥è²¼',
                        highElasticText: 'é«˜å½ˆæ€§',
                        lowElasticText: 'ä½å½ˆæ€§',
                        highSupplyElasticText: 'é«˜å½ˆæ€§',
                        lowSupplyElasticText: 'ä½å½ˆæ€§',
                        benefitText: 'æ¶ˆè²»è€…ç²å¾—æ´¥è²¼',
                        lossText: 'ç”Ÿç”¢è€…ç²å¾—æ´¥è²¼',
                        submitBtnText: 'æäº¤ç­”æ¡ˆ',
                        resetBtnText: 'é‡æ–°æ•´ç†',
                        
                        // ç·´ç¿’é¡Œç›¸é—œ
                        quizTitle: 'å¾é‡æ´¥è²¼èˆ‡å½ˆæ€§ç·´ç¿’é¡Œ',
                        quizLockTitle: 'ğŸ”’ ç·´ç¿’é¡Œå°šæœªè§£é–',
                        quizLockDesc: 'è«‹å…ˆå®Œæˆä»¥ä¸‹ä»»å‹™æ‰èƒ½é–‹å§‹ç·´ç¿’é¡Œï¼š',
                        taskGroup1: 'ä»»å‹™çµ„åˆ1ï¼šé«˜å½ˆæ€§æƒ…å¢ƒ',
                        taskGroup2: 'ä»»å‹™çµ„åˆ2ï¼šä½å½ˆæ€§æƒ…å¢ƒ',
                        highElasticIncomplete: 'âŒ å°šæœªå®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticIncomplete: 'âŒ å°šæœªå®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        highElasticComplete: 'âœ… å·²å®Œæˆé«˜å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        lowElasticComplete: 'âœ… å·²å®Œæˆä½å½ˆæ€§çš„å®Œæ•´ä»»å‹™æµç¨‹',
                        quizHint: 'ğŸ’¡ æç¤ºï¼šæ¯ç¨®å½ˆæ€§é¡å‹éƒ½éœ€è¦å®Œæˆä»»å‹™1-6çš„å®Œæ•´æµç¨‹ï¼ˆé¸æ“‡å¾é‡æ´¥è²¼â†’é¸æ“‡å½ˆæ€§é¡å‹â†’æ‹–æ‹½æ´¥è²¼æ¨™ç±¤â†’æ‹–æ‹½æ¯”è¼ƒç¬¦è™Ÿâ†’æäº¤ç­”æ¡ˆï¼‰',
                        
                        // é¡Œç›®æ¨™é¡Œ
                        q1Title: 'é¡Œç›®1ï¼šæ´¥è²¼åˆ†æ“”ç†è§£',
                        q2Title: 'é¡Œç›®2ï¼šéœ€æ±‚å½ˆæ€§èˆ‡æ´¥è²¼åˆ†æ“”',
                        q3Title: 'é¡Œç›®3ï¼šæ´¥è²¼åˆ†æ“”æ±ºå®šå› ç´ ',
                        q4Title: 'é¡Œç›®4ï¼šç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥',
                        q5Title: 'é¡Œç›®5ï¼šç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥',
                        q6Title: 'é¡Œç›®6ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥',
                        q7Title: 'é¡Œç›®7ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹ç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥',
                        q8Title: 'é¡Œç›®8ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹æ¶ˆè²»è€…ç¸½æ”¯å‡º',
                        q9Title: 'é¡Œç›®9ï¼šé«˜å½ˆæ€§éœ€æ±‚ä¸‹æ´¥è²¼åˆ†æ“”',
                        
                        // é¡Œç›®å…§å®¹
                        q1Question: 'ç•¶æ¶ˆè²»è€…ç²å¾—æ´¥è²¼è¼ƒç”Ÿç”¢è€…å°‘æ™‚ï¼Œæ„å‘³è‘—ï¼š',
                        q2Question: 'ç•¶å•†å“éœ€æ±‚å½ˆæ€§ä½æ–¼ä¾›çµ¦å½ˆæ€§æ™‚ï¼Œå¾é‡æ´¥è²¼ä¸»è¦ç”±èª°ç²å¾—ï¼Ÿ',
                        q3Question: 'å¾é‡æ´¥è²¼çš„å—ç›Šåˆ†æ“”ä¸»è¦å–æ±ºæ–¼ï¼š',
                        q4Question: 'ç•¶æ”¿åºœå¯¦æ–½å¾é‡æ´¥è²¼å¾Œï¼Œç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š',
                        q5Question: 'ç•¶æ”¿åºœå¯¦æ–½å¾é‡æ´¥è²¼å¾Œï¼Œç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š',
                        q6Question: 'ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œç”Ÿç”¢è€…ä¸åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š',
                        q7Question: 'ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œç”Ÿç”¢è€…åŒ…æ‹¬æ´¥è²¼çš„ç¸½æ”¶å…¥æœƒï¼š',
                        q8Question: 'ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œæ¶ˆè²»è€…ç¸½æ”¯å‡ºæœƒï¼š',
                        q9Question: 'ç•¶æ”¿åºœå°ç‰©å“Xå¯¦æ–½å¾é‡æ´¥è²¼ï¼Œè€Œæ¶ˆè²»è€…å°ç‰©å“Xéœ€æ±‚æ˜¯é«˜å½ˆæ€§ï¼Œæ¶ˆè²»è€…å’Œç”Ÿç”¢è€…æ´¥è²¼ç²å¾—æ¯”ä¾‹ï¼š',
                        
                        // é¸é …æ–‡å­—
                        demandLessElastic: 'éœ€æ±‚å½ˆæ€§å°æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| < |Es|ï¼‰',
                        demandMoreElastic: 'éœ€æ±‚å½ˆæ€§å¤§æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| > |Es|ï¼‰',
                        elasticityEqual: 'éœ€æ±‚å½ˆæ€§ç­‰æ–¼ä¾›çµ¦å½ˆæ€§ï¼ˆ|Ed| = |Es|ï¼‰',
                        consumerGainsMore: 'æ¶ˆè²»è€…ç²å¾—è¼ƒå¤šæ´¥è²¼',
                        producerGainsMore: 'ç”Ÿç”¢è€…ç²å¾—è¼ƒå¤šæ´¥è²¼',
                        equalGain: 'æ¶ˆè²»è€…èˆ‡ç”Ÿç”¢è€…å¹³å‡åˆ†äº«',
                        demandElasticityOnly: 'å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§',
                        supplyElasticityOnly: 'å–æ±ºæ–¼ä¾›çµ¦å½ˆæ€§',
                        elasticityRatio: 'å–æ±ºæ–¼éœ€æ±‚å½ˆæ€§èˆ‡ä¾›çµ¦å½ˆæ€§çš„ç›¸å°å¤§å°',
                        increase: 'å¢åŠ ',
                        decrease: 'æ¸›å°‘',
                        uncertain: 'ä¸èƒ½ç¢ºå®š',
                        uncertainRatio: 'ä¸èƒ½ç¢ºå®šé›™æ–¹ç²å¾—æ¯”ä¾‹',
                        
                        totalScoreDefault: 'å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå°‡é¡¯ç¤ºç¸½åˆ†',
                        resetQuizBtn: 'é‡æ–°ä½œç­”'
                    },
                    en: {
                        mainTitle: 'Per-Unit Subsidy VS Demand & Supply Elasticity Interactive Learning',
                        task1Label: 'Task 1: Per-Unit Subsidy',
                        task2Label: 'Task 2: Demand Elasticity Type',
                        task3Label: 'Task 3: Supply Elasticity Type',
                        task4Label: 'Task 4: Drag to Chart',
                        task5Label: 'Task 5: Drag to Chart',
                        task6Label: 'Task 6: Submit',
                        resetLabel: 'Reset',
                        unitSubsidyText: 'Per-Unit Subsidy',
                        highElasticText: 'Elastic',
                        lowElasticText: 'Low Elastic',
                        highSupplyElasticText: 'Elastic',
                        lowSupplyElasticText: 'Low Elastic',
                        benefitText: 'Consumer Gets Subsidy',
                        lossText: 'Producer Gets Subsidy',
                        submitBtnText: 'Submit Answer',
                        resetBtnText: 'Reset All',
                        
                        // Quiz related
                        quizTitle: 'Per-Unit Subsidy & Elasticity Practice Quiz',
                        quizLockTitle: 'ğŸ”’ Quiz Not Yet Unlocked',
                        quizLockDesc: 'Please complete the following tasks before starting the quiz:',
                        taskGroup1: 'Task Group 1: High Elasticity Scenario',
                        taskGroup2: 'Task Group 2: Low Elasticity Scenario',
                        highElasticIncomplete: 'âŒ High elasticity task flow not completed',
                        lowElasticIncomplete: 'âŒ Low elasticity task flow not completed',
                        highElasticComplete: 'âœ… High elasticity task flow completed',
                        lowElasticComplete: 'âœ… Low elasticity task flow completed',
                        quizHint: 'ğŸ’¡ Hint: Each elasticity type requires completing the full task flow 1-6 (Select per-unit subsidy â†’ Select elasticity type â†’ Drag subsidy labels â†’ Drag comparison symbols â†’ Submit answer)',
                        
                        // Question titles
                        q1Title: 'Q1: Understanding Subsidy Distribution',
                        q2Title: 'Q2: Demand Elasticity & Subsidy Distribution',
                        q3Title: 'Q3: Factors Determining Subsidy Distribution',
                        q4Title: 'Q4: Producer Total Revenue Excluding Subsidy',
                        q5Title: 'Q5: Producer Total Revenue Including Subsidy',
                        q6Title: 'Q6: Producer Revenue Excluding Subsidy Under Elastic Demand',
                        q7Title: 'Q7: Producer Revenue Including Subsidy Under Elastic Demand',
                        q8Title: 'Q8: Consumer Total Expenditure Under Elastic Demand',
                        q9Title: 'Q9: Subsidy Distribution Under High Elastic Demand',
                        
                        // Question content
                        q1Question: 'When consumers receive less subsidy than producers, it means:',
                        q2Question: 'When demand elasticity is lower than supply elasticity, who mainly benefits from the per-unit subsidy?',
                        q3Question: 'The distribution of per-unit subsidy benefits mainly depends on:',
                        q4Question: 'When the government implements a per-unit subsidy, producer total revenue excluding subsidy will:',
                        q5Question: 'When the government implements a per-unit subsidy, producer total revenue including subsidy will:',
                        q6Question: 'When the government implements a per-unit subsidy on good X with elastic demand, producer total revenue excluding subsidy will:',
                        q7Question: 'When the government implements a per-unit subsidy on good X with elastic demand, producer total revenue including subsidy will:',
                        q8Question: 'When the government implements a per-unit subsidy on good X with elastic demand, consumer total expenditure will:',
                        q9Question: 'When the government implements a per-unit subsidy on good X with elastic demand, the subsidy distribution ratio between consumers and producers:',
                        
                        // Option texts
                        demandLessElastic: 'Demand elasticity < Supply elasticity (|Ed| < |Es|)',
                        demandMoreElastic: 'Demand elasticity > Supply elasticity (|Ed| > |Es|)',
                        elasticityEqual: 'Demand elasticity = Supply elasticity (|Ed| = |Es|)',
                        consumerGainsMore: 'Consumers receive more subsidy',
                        producerGainsMore: 'Producers receive more subsidy',
                        equalGain: 'Consumers and producers share equally',
                        demandElasticityOnly: 'Depends on demand elasticity',
                        supplyElasticityOnly: 'Depends on supply elasticity',
                        elasticityRatio: 'Depends on relative size of demand and supply elasticity',
                        increase: 'Increase',
                        decrease: 'Decrease',
                        uncertain: 'Be uncertain',
                        uncertainRatio: 'Cannot determine the ratio',
                        
                        totalScoreDefault: 'Total score will be displayed after completing all questions',
                        resetQuizBtn: 'Reset Quiz'
                    }
                };
                this.init();
            }
            
            init() {
                // èªè¨€åˆ‡æ›æŒ‰éˆ•äº‹ä»¶
                document.getElementById('langZh').addEventListener('click', () => {
                    this.switchLanguage('zh');
                });
                
                document.getElementById('langEn').addEventListener('click', () => {
                    this.switchLanguage('en');
                });
                
                // åˆå§‹åŒ–ç‚ºä¸­æ–‡
                this.updateUI();
            }
            
            switchLanguage(lang) {
                this.currentLang = lang;
                this.updateButtonStates();
                this.updateUI();
            }
            
            updateButtonStates() {
                const zhBtn = document.getElementById('langZh');
                const enBtn = document.getElementById('langEn');
                
                // é‡ç½®æŒ‰éˆ•æ¨£å¼
                zhBtn.classList.remove('bg-primary', 'text-white');
                zhBtn.classList.add('text-gray-600', 'dark:text-gray-400');
                enBtn.classList.remove('bg-primary', 'text-white');
                enBtn.classList.add('text-gray-600', 'dark:text-gray-400');
                
                // è¨­ç½®ç•¶å‰èªè¨€æŒ‰éˆ•ç‚ºæ´»èºç‹€æ…‹
                if (this.currentLang === 'zh') {
                    zhBtn.classList.remove('text-gray-600', 'dark:text-gray-400');
                    zhBtn.classList.add('bg-primary', 'text-white');
                } else {
                    enBtn.classList.remove('text-gray-600', 'dark:text-gray-400');
                    enBtn.classList.add('bg-primary', 'text-white');
                }
            }
            
            updateUI() {
                const texts = this.texts[this.currentLang];
                
                // æ›´æ–°æ‰€æœ‰æ–‡æœ¬å…ƒç´ 
                Object.keys(texts).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = texts[key];
                    }
                });
                
                // æ›´æ–°ç·´ç¿’é¡Œå…§å®¹
                this.updateQuizContent();
            }
            
            updateQuizContent() {
                const texts = this.texts[this.currentLang];
                
                // æ›´æ–°é¡Œç›®é¸é …
                const questions = {
                    q1: [
                        { value: 'demand_less_elastic', text: texts.demandLessElastic },
                        { value: 'demand_more_elastic', text: texts.demandMoreElastic },
                        { value: 'elasticity_equal', text: texts.elasticityEqual }
                    ],
                    q2: [
                        { value: 'consumer_gains_more', text: texts.consumerGainsMore },
                        { value: 'producer_gains_more', text: texts.producerGainsMore },
                        { value: 'equal_gain', text: texts.equalGain }
                    ],
                    q3: [
                        { value: 'demand_elasticity_only', text: texts.demandElasticityOnly },
                        { value: 'supply_elasticity_only', text: texts.supplyElasticityOnly },
                        { value: 'elasticity_ratio', text: texts.elasticityRatio }
                    ],
                    q4: [
                        { value: 'increase', text: texts.increase },
                        { value: 'decrease', text: texts.decrease },
                        { value: 'uncertain', text: texts.uncertain }
                    ],
                    q5: [
                        { value: 'increase', text: texts.increase },
                        { value: 'decrease', text: texts.decrease },
                        { value: 'uncertain', text: texts.uncertain }
                    ],
                    q6: [
                        { value: 'increase', text: texts.increase },
                        { value: 'decrease', text: texts.decrease },
                        { value: 'uncertain', text: texts.uncertain }
                    ],
                    q7: [
                        { value: 'increase', text: texts.increase },
                        { value: 'decrease', text: texts.decrease },
                        { value: 'uncertain', text: texts.uncertain }
                    ],
                    q8: [
                        { value: 'increase', text: texts.increase },
                        { value: 'decrease', text: texts.decrease },
                        { value: 'uncertain', text: texts.uncertain }
                    ],
                    q9: [
                        { value: 'consumer_gains_more', text: texts.consumerGainsMore },
                        { value: 'producer_gains_more', text: texts.producerGainsMore },
                        { value: 'uncertain_ratio', text: texts.uncertainRatio }
                    ]
                };
                
                // æ›´æ–°æ¯å€‹é¡Œç›®çš„é¸é …æ–‡å­—
                Object.keys(questions).forEach(questionId => {
                    const options = questions[questionId];
                    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
                    
                    radios.forEach((radio, index) => {
                        const label = radio.parentElement;
                        const span = label.querySelector('span');
                        if (span && options[index]) {
                            span.textContent = options[index].text;
                        }
                    });
                });
            }
        }
        
        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        window.addEventListener('load', () => {
            window.simulator = new ElasticitySimulator('economicChart');
            window.languageManager = new LanguageManager();
            new QuizManager();
        });
    </script>
</body>
</html>
